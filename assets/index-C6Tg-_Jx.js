var P=Object.defineProperty;var T=(o,s,t)=>s in o?P(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var i=(o,s,t)=>T(o,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))e(h);new MutationObserver(h=>{for(const r of h)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(h){const r={};return h.integrity&&(r.integrity=h.integrity),h.referrerPolicy&&(r.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?r.credentials="include":h.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(h){if(h.ep)return;h.ep=!0;const r=t(h);fetch(h.href,r)}})();const a={CANVAS:{WIDTH:400,HEIGHT:600},PLAYER:{WIDTH:50,HEIGHT:50,MAX_SPEED:6,ACCELERATION:.8,DECELERATION:.3,MAX_HEALTH:100,INVINCIBILITY_TIME:1e3,FIRE_RATE:200,COLORS:{PRIMARY:"#1a237e",SECONDARY:"#3f51b5",ACCENT:"#00bcd4",ENGINE:"#ff9800"}},BULLET:{WIDTH:5,HEIGHT:15,SPEED:600},ENEMY:{SPAWN_INTERVAL:1e3,TYPES:{SMALL:{width:30,height:30,speed:180,health:1,score:10,color:"#ff00ff"},MEDIUM:{width:50,height:50,speed:120,health:2,score:20,color:"#00ffff"},LARGE:{width:70,height:70,speed:60,health:3,score:30,color:"#ffff00"}}},BOSS:{WIDTH:150,HEIGHT:150,BULLET_SPEED:200,FIRE_RATE:1e3,INITIAL_HEALTH:50,INITIAL_SPEED:50,MOVEMENT_SPEED:50},POWERUP:{WIDTH:30,HEIGHT:30,SPEED:100,DURATION:1e4,SPAWN_CHANCE:.05,TYPES:{RAPID_FIRE:{color:"#00ff00",effect:o=>{o.setFireRate(a.PLAYER.FIRE_RATE/2)}},TRIPLE_SHOT:{color:"#0000ff",effect:o=>{o.setBulletType("triple")}},SHIELD:{color:"#ffff00",effect:o=>{o.activateShield()}}}},EXPLOSION:{DURATION:30},BACKGROUND:{STAR_COUNT:100,PLANET_COUNT:2,NEBULA_COUNT:1}};class c{constructor(s,t,e,h){this.x=s,this.y=t,this.width=e,this.height=h}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}}class M extends c{constructor(t,e,h,r){const l=a.ENEMY.TYPES[t];super(e,h,l.width,l.height);i(this,"type");i(this,"speed");i(this,"health");i(this,"score");i(this,"color");i(this,"movementPattern");i(this,"movementTimer",0);i(this,"game");i(this,"animationPhase",0);i(this,"subEntities",[]);if(this.type=t,this.speed=l.speed,this.health=l.health,this.score=l.score,this.color=l.color,this.movementPattern=this.getMovementPatternForType(),this.game=r,t==="MEDIUM"){const n=3+Math.floor(Math.random()*3);for(let u=0;u<n;u++)this.subEntities.push({x:(Math.random()-.5)*this.width*.8,y:(Math.random()-.5)*this.height*.8,radius:this.width*(.1+Math.random()*.1)})}}getMovementPatternForType(){switch(this.type){case"SMALL":return"zigzag";case"MEDIUM":return"sine";case"LARGE":return"straight";default:return"straight"}}update(t){const e=1+this.game.getDifficultyFactor();switch(this.y+=this.speed*e*t,this.movementTimer+=3*t,this.movementPattern){case"zigzag":this.x+=Math.sin(this.movementTimer*2)*2;break;case"sine":this.x+=Math.sin(this.movementTimer)*1.5;break}(this.x<0||this.x+this.width>a.CANVAS.WIDTH)&&(this.movementPattern="straight"),this.animationPhase+=t*2,this.type==="MEDIUM"&&this.subEntities.forEach(h=>{h.x+=Math.sin(this.animationPhase+h.y)*.5,h.y+=Math.cos(this.animationPhase+h.x)*.5})}draw(t){switch(t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),this.type){case"SMALL":this.drawSmallUMA(t);break;case"MEDIUM":this.drawMediumUMA(t);break;case"LARGE":this.drawLargeUMA(t);break}t.restore()}drawSmallUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath();for(let h=0;h<12;h++){const r=h/12*Math.PI*2,l=e*(.8+Math.sin(this.animationPhase+h)*.2);t.lineTo(Math.cos(r)*l,Math.sin(r)*l)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.beginPath(),t.arc(0,0,e*.3,0,Math.PI*2),t.fill(),t.strokeStyle=this.color,t.lineWidth=2;for(let h=0;h<5;h++){const r=h/5*Math.PI*2+this.animationPhase;t.beginPath(),t.moveTo(Math.cos(r)*e*.8,Math.sin(r)*e*.8),t.lineTo(Math.cos(r)*e*1.2,Math.sin(r)*e*1.2),t.stroke()}}drawMediumUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=2;for(let h=0;h<8;h++){const r=h/8*Math.PI*2,l=e*(1+Math.sin(this.animationPhase+h)*.2);t.beginPath(),t.moveTo(Math.cos(r)*e,Math.sin(r)*e),t.lineTo(Math.cos(r)*l,Math.sin(r)*l),t.stroke()}this.subEntities.forEach(h=>{t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(h.x,h.y,h.radius,0,Math.PI*2),t.fill()})}drawLargeUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath();for(let h=0;h<6;h++){const r=h/6*Math.PI*2,l=e*(1+Math.cos(this.animationPhase+h)*.1);t.lineTo(Math.cos(r)*l,Math.sin(r)*l)}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=3;for(let h=0;h<6;h++){const r=h/6*Math.PI*2,l=e*(1.2+Math.sin(this.animationPhase+h)*.3);t.beginPath(),t.moveTo(Math.cos(r)*e,Math.sin(r)*e),t.lineTo(Math.cos(r)*l,Math.sin(r)*l),t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(0,0,e*.3,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2;for(let h=0;h<3;h++)t.beginPath(),t.arc(0,0,e*(.5+h*.2),0,Math.PI*2),t.stroke()}takeDamage(){return this.health--,this.health<=0}getScore(){return this.score}isOnScreen(){return this.y<a.CANVAS.HEIGHT}getPosition(){return{x:this.x,y:this.y}}getType(){return this.type}}class w extends c{constructor(t,e){super(t,e,a.POWERUP.WIDTH,a.POWERUP.HEIGHT);i(this,"type");i(this,"color");i(this,"rotation",0);i(this,"rotationSpeed");i(this,"glowIntensity",0);i(this,"glowDirection",1);i(this,"trail",[]);i(this,"trailUpdateCounter",0);this.type=this.getRandomPowerUpType(),this.color=a.POWERUP.TYPES[this.type].color,this.rotationSpeed=Math.random()*.1+.05}getRandomPowerUpType(){const t=Object.keys(a.POWERUP.TYPES);return t[Math.floor(Math.random()*t.length)]}update(t){this.y+=a.POWERUP.SPEED*t,this.rotation+=this.rotationSpeed*t,this.glowIntensity+=.05*this.glowDirection,(this.glowIntensity>=1||this.glowIntensity<=0)&&(this.glowDirection*=-1),this.trailUpdateCounter+=t,this.trailUpdateCounter>=.05&&(this.trail.unshift({x:this.x,y:this.y,alpha:1}),this.trailUpdateCounter=0),this.trail.length>30&&this.trail.pop(),this.trail.forEach(e=>e.alpha-=.02)}draw(t){this.drawTrail(t),t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation);const e=this.width/2+5+this.glowIntensity*3,h=t.createRadialGradient(0,0,this.width/2,0,0,e);h.addColorStop(0,this.color),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(0,0,this.width/2,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),t.beginPath(),t.arc(0,0,this.width/3,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle";let r;switch(this.type){case"RAPID_FIRE":r="R";break;case"TRIPLE_SHOT":r="T";break;case"SHIELD":r="S";break}t.fillText(r,0,0),t.restore()}drawTrail(t){t.save();for(let e=this.trail.length-1;e>=0;e--){const h=this.trail[e],r=this.width/2*(1-e/this.trail.length)*.8;t.fillStyle=`rgba(${parseInt(this.color.slice(1,3),16)}, ${parseInt(this.color.slice(3,5),16)}, ${parseInt(this.color.slice(5,7),16)}, ${h.alpha*.8})`,t.beginPath(),t.arc(h.x+this.width/2,h.y+this.height/2,r,0,Math.PI*2),t.fill()}t.restore()}isOnScreen(){return this.y<a.CANVAS.HEIGHT}getType(){return this.type}}function p(o,s){return Math.random()*(s-o)+o}class m{static createEnemy(s,t){const e=a.ENEMY.TYPES[s],h=p(0,a.CANVAS.WIDTH-e.width);return new M(s,h,-e.height,t)}static createPowerUp(){const s=p(0,a.CANVAS.WIDTH-a.POWERUP.WIDTH);return new w(s,-a.POWERUP.HEIGHT)}}class f{constructor(){i(this,"observers",[]);i(this,"score",0)}attach(s){this.observers.includes(s)||this.observers.push(s)}detach(s){const t=this.observers.indexOf(s);t!==-1&&this.observers.splice(t,1)}notify(){for(const s of this.observers)s.update(this)}getScore(){return this.score}addScore(s){this.score+=s,this.notify()}}class A{constructor(){i(this,"scoreElement");i(this,"levelElement");i(this,"healthElement");i(this,"healthBarElement");this.scoreElement=document.getElementById("scoreValue"),this.levelElement=document.getElementById("levelValue"),this.healthElement=document.getElementById("healthValue"),this.healthBarElement=document.getElementById("healthBarFill")}update(s){s instanceof f&&this.updateScoreDisplay(s.getScore())}updateScoreDisplay(s){this.scoreElement&&(this.scoreElement.textContent=s.toString())}updateLevelDisplay(s){this.levelElement&&(this.levelElement.textContent=s.toString())}updateHealthDisplay(s){if(this.healthElement&&(this.healthElement.textContent=s.toString()),this.healthBarElement){const t=s/a.PLAYER.MAX_HEALTH*100;this.healthBarElement.style.width=`${t}%`}}}class I{constructor(){i(this,"curves");i(this,"colors");this.curves=Array(5).fill(null).map(()=>({offset:Math.random()*Math.PI*2,amplitude:Math.random()*40+20,speed:(Math.random()+.5)*5e-4})),this.colors=["rgba(0, 255, 100, 0.1)","rgba(0, 200, 255, 0.1)","rgba(100, 0, 255, 0.1)","rgba(255, 100, 200, 0.1)","rgba(255, 200, 0, 0.1)"]}update(s){this.curves.forEach(t=>{t.offset+=t.speed*s})}draw(s){s.save(),s.globalCompositeOperation="screen",this.curves.forEach((t,e)=>{const h=s.createLinearGradient(0,0,a.CANVAS.WIDTH,0);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(.5,this.colors[e]),h.addColorStop(1,"rgba(0, 0, 0, 0)"),s.fillStyle=h;const r=Math.sin(t.offset)*t.amplitude+a.CANVAS.HEIGHT/3;s.beginPath(),s.moveTo(0,r);for(let l=0;l<=a.CANVAS.WIDTH;l+=5){const n=l/a.CANVAS.WIDTH,u=Math.sin(t.offset+n*Math.PI*4)*t.amplitude;s.lineTo(l,r+u)}s.lineTo(a.CANVAS.WIDTH,a.CANVAS.HEIGHT),s.lineTo(0,a.CANVAS.HEIGHT),s.closePath(),s.fill()}),s.restore()}}class b extends c{constructor(t,e,h,r){super(t,e,a.BULLET.WIDTH,a.BULLET.HEIGHT);i(this,"speedX");i(this,"speedY");this.speedX=h,this.speedY=r}update(t){this.x+=this.speedX*t,this.y+=this.speedY*t}draw(t){t.fillStyle="#ff00ff",t.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y<a.CANVAS.HEIGHT&&this.y>0&&this.x<a.CANVAS.WIDTH&&this.x>0}}class v extends c{constructor(t){super(a.CANVAS.WIDTH/2-a.BOSS.WIDTH/2,-a.BOSS.HEIGHT,a.BOSS.WIDTH,a.BOSS.HEIGHT);i(this,"health");i(this,"moveDirection",1);i(this,"lastFireTime",0);i(this,"game");this.health=t.getCurrentBossHealth(),this.game=t}update(t){if(this.y<50)this.y+=a.BOSS.INITIAL_SPEED*t;else{const h=this.x+this.moveDirection*a.BOSS.MOVEMENT_SPEED*t;h<=0?(this.x=0,this.moveDirection=1):h+this.width>=a.CANVAS.WIDTH?(this.x=a.CANVAS.WIDTH-this.width,this.moveDirection=-1):this.x=h}const e=Date.now();e-this.lastFireTime>a.BOSS.FIRE_RATE&&(this.shoot(),this.lastFireTime=e)}shoot(){const t=Math.PI/8;for(let e=-1;e<=1;e++){const h=e*t,r=Math.sin(h)*a.BOSS.BULLET_SPEED,l=Math.cos(h)*a.BOSS.BULLET_SPEED;this.game.addBossBullet(new b(this.x+this.width/2,this.y+this.height,r,l))}}draw(t){t.fillStyle="#ff0000",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.fill();const e=this.health/a.BOSS.INITIAL_HEALTH;t.fillStyle="#00ff00",t.fillRect(this.x,this.y-20,this.width*e,10),t.strokeStyle="#ffffff",t.strokeRect(this.x,this.y-20,this.width,10)}takeDamage(){return this.health--,this.health<=0}getPosition(){return{x:this.x,y:this.y}}}class y{constructor({x:s,y:t},e=1){i(this,"x");i(this,"y");i(this,"particles");i(this,"duration");i(this,"currentFrame");i(this,"maxRadius");this.maxRadius=30*e,this.x=s,this.y=t,this.particles=[],this.duration=a.EXPLOSION.DURATION,this.currentFrame=0;const h=Math.floor(50*e);for(let r=0;r<h;r++){const l=Math.random()*Math.PI*2,n=Math.random()*this.maxRadius;this.particles.push({x:this.x+Math.cos(l)*n*Math.random(),y:this.y+Math.sin(l)*n*Math.random(),radius:Math.random()*4+1,speed:Math.random()*100+25,angle:l,color:this.getExplosionColor()})}}getExplosionColor(){const s=Math.random()*60+10,t=100,e=50+Math.random()*30;return`hsl(${s}, ${t}%, ${e}%)`}update(s){this.currentFrame++;const t=this.currentFrame/this.duration;this.particles.forEach(e=>{const h=t<.2?1:1-(t-.2)/.8;e.x+=Math.cos(e.angle)*e.speed*s*h,e.y+=Math.sin(e.angle)*e.speed*s*h,e.radius*=.98,e.speed*=.98})}draw(s){const t=this.currentFrame/this.duration;this.particles.forEach(e=>{s.beginPath(),s.arc(e.x,e.y,e.radius,0,Math.PI*2),s.fillStyle=e.color,s.globalAlpha=Math.max(0,1-t**1.5),s.fill(),s.beginPath(),s.arc(e.x,e.y,e.radius*1.2,0,Math.PI*2),s.fillStyle="rgba(255, 255, 255, 0.2)",s.fill()}),s.globalAlpha=1}isFinished(){return this.currentFrame>=this.duration}}class C{constructor(){i(this,"x");i(this,"y");i(this,"width");i(this,"height");i(this,"color");i(this,"particles");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.width=Math.random()*200+100,this.height=Math.random()*200+100,this.color=`hsla(${Math.random()*360}, 70%, 50%, 0.2)`,this.particles=this.generateParticles()}generateParticles(){return Array(50).fill(null).map(()=>({x:(Math.random()-.5)*this.width,y:(Math.random()-.5)*this.height,radius:Math.random()*3+1,alpha:Math.random()*.5+.2}))}draw(s){s.save(),s.translate(this.x,this.y),s.fillStyle=this.color,s.beginPath(),s.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),s.fill(),s.fillStyle=this.color.replace("0.2","1"),this.particles.forEach(t=>{s.globalAlpha=t.alpha,s.beginPath(),s.arc(t.x,t.y,t.radius,0,Math.PI*2),s.fill()}),s.restore()}}class D{constructor(){i(this,"x");i(this,"y");i(this,"radius");i(this,"baseColor");i(this,"craters");i(this,"rotation");i(this,"rotationSpeed");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.radius=Math.random()*30+20,this.baseColor=`hsl(${Math.random()*360}, 50%, 50%)`,this.craters=this.generateCraters(),this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01}generateCraters(){const s=Math.floor(Math.random()*5)+3;return Array(s).fill(null).map(()=>({x:(Math.random()-.5)*this.radius*1.5,y:(Math.random()-.5)*this.radius*1.5,radius:Math.random()*(this.radius*.3)+this.radius*.1}))}update(s){this.rotation+=this.rotationSpeed*s}draw(s){s.save(),s.translate(this.x,this.y),s.rotate(this.rotation),s.fillStyle=this.baseColor,s.beginPath(),s.arc(0,0,this.radius,0,Math.PI*2),s.fill(),s.fillStyle="rgba(0, 0, 0, 0.2)",this.craters.forEach(t=>{s.beginPath(),s.arc(t.x,t.y,t.radius,0,Math.PI*2),s.fill()}),s.restore()}}class g extends c{constructor(s,t){super(s,t,a.BULLET.WIDTH,a.BULLET.HEIGHT)}update(s){this.y-=a.BULLET.SPEED*s}draw(s){s.fillStyle="#ff0000",s.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y+this.height>0}}class E extends c{constructor(t){super(a.CANVAS.WIDTH/2-a.PLAYER.WIDTH/2,a.CANVAS.HEIGHT-a.PLAYER.HEIGHT-10,a.PLAYER.WIDTH,a.PLAYER.HEIGHT);i(this,"velocity",{x:0,y:0});i(this,"health");i(this,"fireRate");i(this,"bulletType","single");i(this,"shieldActive",!1);i(this,"activePowerups",[]);i(this,"keys",{});i(this,"engineAnimationPhase",0);i(this,"invincible",!1);i(this,"lastHitTime",0);i(this,"lastFireTime",0);i(this,"thrusterParticles",[]);this.game=t,this.health=a.PLAYER.MAX_HEALTH,this.fireRate=a.PLAYER.FIRE_RATE}setKeyState(t,e){this.keys[t]=e}update(t){this.updateMovement(),this.updateShooting(),this.updateInvincibility(),this.updateEngineAnimation(t),this.updateThrusterParticles(t)}updateMovement(){const{CANVAS:t}=a;this.updateVelocity(),this.x+=this.velocity.x,this.clampPosition(0,t.WIDTH-this.width),this.generateThrusterParticles()}updateVelocity(){const{ACCELERATION:t,MAX_SPEED:e}=a.PLAYER;this.keys.ArrowLeft?this.velocity.x=Math.max(this.velocity.x-t,-e):this.keys.ArrowRight?this.velocity.x=Math.min(this.velocity.x+t,e):this.applyDeceleration()}applyDeceleration(){const{DECELERATION:t}=a.PLAYER;this.velocity.x>0?this.velocity.x=Math.max(0,this.velocity.x-t):this.velocity.x<0&&(this.velocity.x=Math.min(0,this.velocity.x+t))}clampPosition(t,e){this.x<t?(this.x=t,this.velocity.x=0):this.x>e&&(this.x=e,this.velocity.x=0)}updateShooting(){this.keys[" "]&&this.shoot()}shoot(){const t=Date.now();t-this.lastFireTime>=this.fireRate&&(this.bulletType==="single"?this.game.addBullet(new g(this.x+this.width/2-a.BULLET.WIDTH/2,this.y)):this.bulletType==="triple"&&(this.game.addBullet(new g(this.x+this.width/2-a.BULLET.WIDTH/2,this.y)),this.game.addBullet(new g(this.x+this.width/2-a.BULLET.WIDTH/2-20,this.y+10)),this.game.addBullet(new g(this.x+this.width/2-a.BULLET.WIDTH/2+20,this.y+10))),this.lastFireTime=t)}updateInvincibility(){this.invincible&&Date.now()-this.lastHitTime>a.PLAYER.INVINCIBILITY_TIME&&(this.invincible=!1)}updateEngineAnimation(t){this.engineAnimationPhase+=10*t,this.engineAnimationPhase>Math.PI*2&&(this.engineAnimationPhase=0)}generateThrusterParticles(){for(let e=0;e<3;e++)this.thrusterParticles.push({x:this.x+this.width/2,y:this.y+this.height,speed:Math.random()*50+50,life:1})}updateThrusterParticles(t){for(let e=this.thrusterParticles.length-1;e>=0;e--){const h=this.thrusterParticles[e];h.y+=h.speed*t,h.life-=t,h.life<=0&&this.thrusterParticles.splice(e,1)}}draw(t){this.drawThrusterParticles(t),this.drawShip(t),this.drawShield(t)}drawShip(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.fillStyle=this.invincible?"rgba(255, 0, 0, 0.5)":a.PLAYER.COLORS.PRIMARY,t.beginPath(),t.moveTo(0,-this.height/2),t.lineTo(-this.width/2,this.height/2),t.lineTo(this.width/2,this.height/2),t.closePath(),t.fill(),t.fillStyle=a.PLAYER.COLORS.SECONDARY,t.beginPath(),t.moveTo(-this.width/4,0),t.lineTo(-this.width/2,this.height/2),t.lineTo(0,this.height/4),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.width/4,0),t.lineTo(this.width/2,this.height/2),t.lineTo(0,this.height/4),t.closePath(),t.fill(),t.fillStyle=a.PLAYER.COLORS.ACCENT,t.beginPath(),t.ellipse(0,-this.height/6,this.width/6,this.height/6,0,0,Math.PI*2),t.fill();const e=10+Math.sin(this.engineAnimationPhase)*3,h=t.createRadialGradient(0,this.height/2,0,0,this.height/2,e);h.addColorStop(0,a.PLAYER.COLORS.ENGINE),h.addColorStop(.5,"rgba(255, 100, 0, 0.5)"),h.addColorStop(1,"rgba(255, 0, 0, 0)"),t.fillStyle=h,t.beginPath(),t.arc(0,this.height/2,e,0,Math.PI*2),t.fill(),t.restore()}drawThrusterParticles(t){t.save();for(const e of this.thrusterParticles){const h=e.life,r=5*e.life;t.fillStyle=`rgba(255, 100, 0, ${h})`,t.beginPath(),t.arc(e.x,e.y,r,0,Math.PI*2),t.fill()}t.restore()}drawShield(t){if(this.shieldActive){t.save(),t.strokeStyle="rgba(0, 255, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2),t.stroke();const e=t.createRadialGradient(this.x+this.width/2,this.y+this.height/2,this.width/2,this.x+this.width/2,this.y+this.height/2,this.width/2+15);e.addColorStop(0,"rgba(0, 255, 255, 0.1)"),e.addColorStop(1,"rgba(0, 255, 255, 0)"),t.fillStyle=e,t.fill(),t.restore()}}takeDamage(t){!this.invincible&&!this.shieldActive&&(this.health=Math.max(0,this.health-t),this.invincible=!0,this.lastHitTime=Date.now(),this.health<=0&&this.game.gameOver())}activatePowerup(t){a.POWERUP.TYPES[t].effect(this),this.activePowerups.push({type:t,startTime:Date.now()}),setTimeout(()=>this.deactivatePowerup(t),a.POWERUP.DURATION)}deactivatePowerup(t){switch(this.activePowerups=this.activePowerups.filter(e=>e.type!==t),t){case"RAPID_FIRE":this.fireRate=a.PLAYER.FIRE_RATE;break;case"TRIPLE_SHOT":this.bulletType="single";break;case"SHIELD":this.shieldActive=!1;break}}getHealth(){return this.health}setFireRate(t){this.fireRate=t}setBulletType(t){this.bulletType=t}activateShield(){this.shieldActive=!0}getPosition(){return{x:this.x,y:this.y}}}class H{constructor(){i(this,"x");i(this,"y");i(this,"size");i(this,"speed");i(this,"twinkleSpeed");i(this,"twinkleOffset");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.size=Math.random()*2+1,this.speed=Math.random()*10+5,this.twinkleSpeed=Math.random()*.05+.01,this.twinkleOffset=Math.random()*Math.PI*2}update(s){this.y+=this.speed*s,this.y>a.CANVAS.HEIGHT&&(this.y=0,this.x=Math.random()*a.CANVAS.WIDTH),this.twinkleOffset+=this.twinkleSpeed}draw(s){const t=Math.sin(this.twinkleOffset)*.5+.5;s.fillStyle=`rgba(255, 255, 255, ${.5+t*.5})`,s.beginPath(),s.arc(this.x,this.y,this.size*(.8+t*.2),0,Math.PI*2),s.fill()}}class L{constructor(){i(this,"events",{})}on(s,t){this.events[s]||(this.events[s]=[]),this.events[s].push(t)}off(s,t){this.events[s]&&(this.events[s]=this.events[s].filter(e=>e!==t))}emit(s,...t){this.events[s]&&this.events[s].forEach(e=>e(...t))}}class O{constructor(){i(this,"currentState",0)}setState(s){this.currentState=s}getState(){return this.currentState}isPlaying(){return this.currentState===1}}var d=(o=>(o[o.STARTING=0]="STARTING",o[o.PLAYING=1]="PLAYING",o[o.PAUSED=2]="PAUSED",o[o.GAME_OVER=3]="GAME_OVER",o))(d||{});class R extends L{constructor(){super();i(this,"canvas");i(this,"ctx");i(this,"player");i(this,"bullets",[]);i(this,"enemies",[]);i(this,"stars",[]);i(this,"explosions",[]);i(this,"planets",[]);i(this,"nebulas",[]);i(this,"auroras",[]);i(this,"powerups",[]);i(this,"boss",null);i(this,"bossBullets",[]);i(this,"level",1);i(this,"bossSpawnScore",1e3);i(this,"currentScore",0);i(this,"lastTime",0);i(this,"deltaTime",0);i(this,"stateManager",new O);i(this,"scoreManager",new f);i(this,"uiManager",new A);i(this,"difficultyFactor",0);i(this,"currentBossHealth",a.BOSS.INITIAL_HEALTH);i(this,"handleKeyDown",t=>{this.player.setKeyState(t.key,!0)});i(this,"handleKeyUp",t=>{this.player.setKeyState(t.key,!1)});i(this,"handleEnemyDestroyed",t=>{const e=t.getPosition(),h={x:e.x+t.getWidth()/2,y:e.y+t.getHeight()/2};this.explosions.push(new y(h)),this.scoreManager.addScore(t.getScore())});i(this,"handlePlayerDamaged",t=>{this.player.takeDamage(t),this.player.getHealth()<=0&&this.gameOver()});i(this,"handleBossDamaged",()=>{this.boss&&this.boss.takeDamage()&&this.emit("bossDefeated")});i(this,"handleBossDefeated",()=>{this.boss&&(this.explosions.push(new y(this.boss.getPosition())),this.boss=null,this.handleBossDefeat())});i(this,"handlePowerUpCollected",t=>{this.player.activatePowerup(t.getType())});i(this,"gameLoop",t=>{this.deltaTime=(t-this.lastTime)/1e3,this.lastTime=t,this.stateManager.isPlaying()&&(this.update(),this.draw()),requestAnimationFrame(this.gameLoop)});i(this,"spawnEnemy",()=>{if(this.stateManager.isPlaying()&&!this.boss){const t=Object.keys(a.ENEMY.TYPES),e=t[Math.floor(Math.random()*t.length)];this.enemies.push(m.createEnemy(e,this)),Math.random()<a.POWERUP.SPAWN_CHANCE&&this.powerups.push(m.createPowerUp())}});i(this,"restartGame",()=>{const t=document.getElementById("gameOver");t&&t.classList.add("hidden"),this.resetGame(),this.start()});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=a.CANVAS.WIDTH,this.canvas.height=a.CANVAS.HEIGHT,this.player=new E(this),this.initializeGameObjects(),this.setupEventListeners(),this.scoreManager.attach(this.uiManager),this.stateManager.setState(d.PLAYING)}initializeGameObjects(){this.stars=Array.from({length:a.BACKGROUND.STAR_COUNT},()=>new H),this.planets=Array.from({length:a.BACKGROUND.PLANET_COUNT},()=>new D),this.nebulas=Array.from({length:a.BACKGROUND.NEBULA_COUNT},()=>new C),this.auroras=Array.from({length:2},()=>new I)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp);const t=document.getElementById("restartButton");t&&t.addEventListener("click",this.restartGame),this.on("enemyDestroyed",this.handleEnemyDestroyed),this.on("playerDamaged",this.handlePlayerDamaged),this.on("bossDamaged",this.handleBossDamaged),this.on("bossDefeated",this.handleBossDefeated),this.on("powerUpCollected",this.handlePowerUpCollected)}start(){this.gameLoop(0),setInterval(this.spawnEnemy,a.ENEMY.SPAWN_INTERVAL)}update(){this.player.update(this.deltaTime),this.updateGameObjects(),this.checkCollisions(),this.removeOffscreenObjects(),this.uiManager.updateHealthDisplay(this.player.getHealth()),this.uiManager.updateLevelDisplay(this.level)}updateGameObjects(){const t=[...this.bullets,...this.enemies,...this.powerups,...this.explosions,...this.stars,...this.planets,...this.auroras,...this.bossBullets];this.boss&&t.push(this.boss),t.forEach(e=>e.update(this.deltaTime)),this.currentScore=this.scoreManager.getScore(),this.currentScore>=this.bossSpawnScore&&!this.boss&&this.spawnBoss()}spawnBoss(){this.boss=new v(this),this.showMessage("ボスが出現しました！")}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions(),this.checkPlayerPowerupCollisions(),this.boss&&this.checkBossBattleCollisions()}checkBulletEnemyCollisions(){for(let t=this.bullets.length-1;t>=0;t--)for(let e=this.enemies.length-1;e>=0;e--)if(this.checkCollision(this.bullets[t],this.enemies[e])){this.bullets.splice(t,1),this.enemies[e].takeDamage()&&(this.emit("enemyDestroyed",this.enemies[e]),this.enemies.splice(e,1));break}}checkPlayerEnemyCollisions(){for(let t=this.enemies.length-1;t>=0;t--)this.checkCollision(this.player,this.enemies[t])&&(this.emit("playerDamaged",20),this.emit("enemyDestroyed",this.enemies[t]),this.enemies.splice(t,1))}checkPlayerPowerupCollisions(){for(let t=this.powerups.length-1;t>=0;t--)this.checkCollision(this.player,this.powerups[t])&&(this.emit("powerUpCollected",this.powerups[t]),this.powerups.splice(t,1))}checkBossBattleCollisions(){this.boss&&this.checkCollision(this.player,this.boss)&&this.emit("playerDamaged",20);for(let t=this.bullets.length-1;t>=0;t--)this.boss&&this.checkCollision(this.bullets[t],this.boss)&&(this.bullets.splice(t,1),this.emit("bossDamaged"));for(let t=this.bossBullets.length-1;t>=0;t--)this.checkCollision(this.player,this.bossBullets[t])&&(this.emit("playerDamaged",20),this.bossBullets.splice(t,1))}removeOffscreenObjects(){this.bullets=this.bullets.filter(t=>t.isOnScreen()),this.enemies=this.enemies.filter(t=>t.isOnScreen()),this.powerups=this.powerups.filter(t=>t.isOnScreen()),this.explosions=this.explosions.filter(t=>!t.isFinished()),this.bossBullets=this.bossBullets.filter(t=>t.isOnScreen())}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,a.CANVAS.HEIGHT);t.addColorStop(0,"rgba(10, 10, 35, 1)"),t.addColorStop(.5,"rgba(20, 20, 50, 1)"),t.addColorStop(1,"rgba(30, 30, 70, 1)"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,a.CANVAS.WIDTH,a.CANVAS.HEIGHT),this.nebulas.forEach(e=>e.draw(this.ctx)),this.planets.forEach(e=>e.draw(this.ctx)),this.stars.forEach(e=>e.draw(this.ctx)),this.auroras.forEach(e=>e.draw(this.ctx)),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=.5,this.ctx.beginPath(),this.ctx.moveTo(50,50),this.ctx.lineTo(100,100),this.ctx.lineTo(150,75),this.ctx.lineTo(200,150),this.ctx.stroke()}draw(){this.drawBackground(),this.player.draw(this.ctx),this.bullets.forEach(t=>t.draw(this.ctx)),this.enemies.forEach(t=>t.draw(this.ctx)),this.powerups.forEach(t=>t.draw(this.ctx)),this.explosions.forEach(t=>t.draw(this.ctx)),this.boss&&(this.boss.draw(this.ctx),this.bossBullets.forEach(t=>t.draw(this.ctx)))}checkCollision(t,e){return t.getX()<e.getX()+e.getWidth()&&t.getX()+t.getWidth()>e.getX()&&t.getY()<e.getY()+e.getHeight()&&t.getY()+t.getHeight()>e.getY()}gameOver(){this.stateManager.setState(d.GAME_OVER);const t=document.getElementById("gameOver");t&&t.classList.remove("hidden");const e=document.getElementById("finalScore");e&&(e.textContent=this.scoreManager.getScore().toString())}resetGame(){this.player=new E(this),this.bullets=[],this.enemies=[],this.powerups=[],this.explosions=[],this.boss=null,this.bossBullets=[],this.level=1,this.bossSpawnScore=1e3,this.scoreManager=new f,this.scoreManager.attach(this.uiManager),this.stateManager.setState(d.PLAYING)}handleBossDefeat(){this.scoreManager.addScore(500),this.showMessage(`レベル ${this.level} クリア！次のレベルが始まります。`),this.level++,this.uiManager.updateLevelDisplay(this.level),setTimeout(()=>{this.startNextLevel()},3e3),this.bossSpawnScore=this.currentScore+1e3}startNextLevel(){this.enemies=[],this.bossBullets=[],this.powerups=[],this.difficultyFactor=this.level*.1,this.currentBossHealth=a.BOSS.INITIAL_HEALTH+(this.level-1)*10,this.bossSpawnScore=this.scoreManager.getScore()+1e3,this.showMessage(`レベル ${this.level} 開始！`)}showMessage(t){const e=document.createElement("div");e.textContent=t,e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.color="white",e.style.fontSize="24px",e.style.textAlign="center",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3)}addBullet(t){this.bullets.push(t)}addBossBullet(t){this.bossBullets.push(t)}pauseGame(){this.stateManager.setState(d.PAUSED)}resumeGame(){this.stateManager.setState(d.PLAYING)}getDifficultyFactor(){return this.difficultyFactor}getCurrentBossHealth(){return this.currentBossHealth}}let S;function N(){S=new R,S.start()}document.addEventListener("DOMContentLoaded",N);
