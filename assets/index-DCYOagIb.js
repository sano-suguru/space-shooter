var S=Object.defineProperty;var T=(r,s,t)=>s in r?S(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var i=(r,s,t)=>T(r,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const h={CANVAS:{WIDTH:400,HEIGHT:600},PLAYER:{WIDTH:50,HEIGHT:50,MAX_SPEED:128,ACCELERATION:3,DECELERATION:2,MAX_HEALTH:100,INVINCIBILITY_TIME:1e3,FIRE_RATE:200},BULLET:{WIDTH:5,HEIGHT:15,SPEED:600},ENEMY:{SPAWN_INTERVAL:1e3,TYPES:{SMALL:{width:30,height:30,speed:180,health:1,score:10,color:"#ff00ff"},MEDIUM:{width:50,height:50,speed:120,health:2,score:20,color:"#00ffff"},LARGE:{width:70,height:70,speed:60,health:3,score:30,color:"#ffff00"}}},BOSS:{WIDTH:150,HEIGHT:150,BULLET_SPEED:200,FIRE_RATE:1e3,INITIAL_HEALTH:50,INITIAL_SPEED:50,MOVEMENT_SPEED:50},POWERUP:{WIDTH:30,HEIGHT:30,SPEED:100,DURATION:1e4,SPAWN_CHANCE:.05,TYPES:{RAPID_FIRE:{color:"#00ff00",effect:r=>{r.setFireRate(h.PLAYER.FIRE_RATE/2)}},TRIPLE_SHOT:{color:"#0000ff",effect:r=>{r.setBulletType("triple")}},SHIELD:{color:"#ffff00",effect:r=>{r.activateShield()}}}},EXPLOSION:{DURATION:30},BACKGROUND:{STAR_COUNT:100,PLANET_COUNT:2,NEBULA_COUNT:1}};class d{constructor(s,t,e,a){this.x=s,this.y=t,this.width=e,this.height=a}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}}class A extends d{constructor(t,e,a,o){const n=h.ENEMY.TYPES[t];super(e,a,n.width,n.height);i(this,"type");i(this,"speed");i(this,"health");i(this,"score");i(this,"color");i(this,"movementPattern");i(this,"movementTimer",0);i(this,"game");i(this,"animationPhase",0);i(this,"subEntities",[]);if(this.type=t,this.speed=n.speed,this.health=n.health,this.score=n.score,this.color=n.color,this.movementPattern=this.getMovementPatternForType(),this.game=o,t==="MEDIUM"){const c=3+Math.floor(Math.random()*3);for(let f=0;f<c;f++)this.subEntities.push({x:(Math.random()-.5)*this.width*.8,y:(Math.random()-.5)*this.height*.8,radius:this.width*(.1+Math.random()*.1)})}}getMovementPatternForType(){switch(this.type){case"SMALL":return"zigzag";case"MEDIUM":return"sine";case"LARGE":return"straight";default:return"straight"}}update(t){const e=1+this.game.getDifficultyFactor();switch(this.y+=this.speed*e*t,this.movementTimer+=3*t,this.movementPattern){case"zigzag":this.x+=Math.sin(this.movementTimer*2)*2;break;case"sine":this.x+=Math.sin(this.movementTimer)*1.5;break}(this.x<0||this.x+this.width>h.CANVAS.WIDTH)&&(this.movementPattern="straight"),this.animationPhase+=t*2,this.type==="MEDIUM"&&this.subEntities.forEach(a=>{a.x+=Math.sin(this.animationPhase+a.y)*.5,a.y+=Math.cos(this.animationPhase+a.x)*.5})}draw(t){switch(t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),this.type){case"SMALL":this.drawSmallUMA(t);break;case"MEDIUM":this.drawMediumUMA(t);break;case"LARGE":this.drawLargeUMA(t);break}t.restore()}drawSmallUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<12;a++){const o=a/12*Math.PI*2,n=e*(.8+Math.sin(this.animationPhase+a)*.2);t.lineTo(Math.cos(o)*n,Math.sin(o)*n)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.beginPath(),t.arc(0,0,e*.3,0,Math.PI*2),t.fill(),t.strokeStyle=this.color,t.lineWidth=2;for(let a=0;a<5;a++){const o=a/5*Math.PI*2+this.animationPhase;t.beginPath(),t.moveTo(Math.cos(o)*e*.8,Math.sin(o)*e*.8),t.lineTo(Math.cos(o)*e*1.2,Math.sin(o)*e*1.2),t.stroke()}}drawMediumUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=2;for(let a=0;a<8;a++){const o=a/8*Math.PI*2,n=e*(1+Math.sin(this.animationPhase+a)*.2);t.beginPath(),t.moveTo(Math.cos(o)*e,Math.sin(o)*e),t.lineTo(Math.cos(o)*n,Math.sin(o)*n),t.stroke()}this.subEntities.forEach(a=>{t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(a.x,a.y,a.radius,0,Math.PI*2),t.fill()})}drawLargeUMA(t){const e=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<6;a++){const o=a/6*Math.PI*2,n=e*(1+Math.cos(this.animationPhase+a)*.1);t.lineTo(Math.cos(o)*n,Math.sin(o)*n)}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=3;for(let a=0;a<6;a++){const o=a/6*Math.PI*2,n=e*(1.2+Math.sin(this.animationPhase+a)*.3);t.beginPath(),t.moveTo(Math.cos(o)*e,Math.sin(o)*e),t.lineTo(Math.cos(o)*n,Math.sin(o)*n),t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(0,0,e*.3,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2;for(let a=0;a<3;a++)t.beginPath(),t.arc(0,0,e*(.5+a*.2),0,Math.PI*2),t.stroke()}takeDamage(){return this.health--,this.health<=0}getScore(){return this.score}isOnScreen(){return this.y<h.CANVAS.HEIGHT}getPosition(){return{x:this.x,y:this.y}}getType(){return this.type}}class M extends d{constructor(t,e){super(t,e,h.POWERUP.WIDTH,h.POWERUP.HEIGHT);i(this,"type");i(this,"color");i(this,"rotation",0);i(this,"rotationSpeed");this.type=this.getRandomPowerUpType(),this.color=h.POWERUP.TYPES[this.type].color,this.rotationSpeed=Math.random()*.1+.05}getRandomPowerUpType(){const t=Object.keys(h.POWERUP.TYPES);return t[Math.floor(Math.random()*t.length)]}update(t){this.y+=h.POWERUP.SPEED*t,this.rotation+=this.rotationSpeed*t}draw(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation),t.beginPath(),t.arc(0,0,this.width/2,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),t.beginPath(),t.arc(0,0,this.width/3,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle";let e;switch(this.type){case"RAPID_FIRE":e="R";break;case"TRIPLE_SHOT":e="T";break;case"SHIELD":e="S";break}t.fillText(e,0,0),t.restore()}isOnScreen(){return this.y<h.CANVAS.HEIGHT}getType(){return this.type}}function m(r,s){return Math.random()*(s-r)+r}class E{static createEnemy(s,t){const e=h.ENEMY.TYPES[s],a=m(0,h.CANVAS.WIDTH-e.width);return new A(s,a,-e.height,t)}static createPowerUp(){const s=m(0,h.CANVAS.WIDTH-h.POWERUP.WIDTH);return new M(s,-h.POWERUP.HEIGHT)}}class g{constructor(){i(this,"observers",[]);i(this,"score",0)}attach(s){this.observers.includes(s)||this.observers.push(s)}detach(s){const t=this.observers.indexOf(s);t!==-1&&this.observers.splice(t,1)}notify(){for(const s of this.observers)s.update(this)}getScore(){return this.score}addScore(s){this.score+=s,this.notify()}}class w{constructor(){i(this,"scoreElement");i(this,"levelElement");i(this,"healthElement");i(this,"healthBarElement");this.scoreElement=document.getElementById("scoreValue"),this.levelElement=document.getElementById("levelValue"),this.healthElement=document.getElementById("healthValue"),this.healthBarElement=document.getElementById("healthBarFill")}update(s){s instanceof g&&this.updateScoreDisplay(s.getScore())}updateScoreDisplay(s){this.scoreElement&&(this.scoreElement.textContent=s.toString())}updateLevelDisplay(s){this.levelElement&&(this.levelElement.textContent=s.toString())}updateHealthDisplay(s){if(this.healthElement&&(this.healthElement.textContent=s.toString()),this.healthBarElement){const t=s/h.PLAYER.MAX_HEALTH*100;this.healthBarElement.style.width=`${t}%`}}}class I extends d{constructor(t,e,a,o){super(t,e,h.BULLET.WIDTH,h.BULLET.HEIGHT);i(this,"speedX");i(this,"speedY");this.speedX=a,this.speedY=o}update(t){this.x+=this.speedX*t,this.y+=this.speedY*t}draw(t){t.fillStyle="#ff00ff",t.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y<h.CANVAS.HEIGHT&&this.y>0&&this.x<h.CANVAS.WIDTH&&this.x>0}}class b extends d{constructor(t){super(h.CANVAS.WIDTH/2-h.BOSS.WIDTH/2,-h.BOSS.HEIGHT,h.BOSS.WIDTH,h.BOSS.HEIGHT);i(this,"health");i(this,"moveDirection",1);i(this,"lastFireTime",0);i(this,"game");this.health=t.getCurrentBossHealth(),this.game=t}update(t){if(this.y<50)this.y+=h.BOSS.INITIAL_SPEED*t;else{const a=this.x+this.moveDirection*h.BOSS.MOVEMENT_SPEED*t;a<=0?(this.x=0,this.moveDirection=1):a+this.width>=h.CANVAS.WIDTH?(this.x=h.CANVAS.WIDTH-this.width,this.moveDirection=-1):this.x=a}const e=Date.now();e-this.lastFireTime>h.BOSS.FIRE_RATE&&(this.shoot(),this.lastFireTime=e)}shoot(){const t=Math.PI/8;for(let e=-1;e<=1;e++){const a=e*t,o=Math.sin(a)*h.BOSS.BULLET_SPEED,n=Math.cos(a)*h.BOSS.BULLET_SPEED;this.game.addBossBullet(new I(this.x+this.width/2,this.y+this.height,o,n))}}draw(t){t.fillStyle="#ff0000",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.fill();const e=this.health/h.BOSS.INITIAL_HEALTH;t.fillStyle="#00ff00",t.fillRect(this.x,this.y-20,this.width*e,10),t.strokeStyle="#ffffff",t.strokeRect(this.x,this.y-20,this.width,10)}takeDamage(){return this.health--,this.health<=0}getPosition(){return{x:this.x,y:this.y}}}class y{constructor({x:s,y:t},e=1){i(this,"x");i(this,"y");i(this,"particles");i(this,"duration");i(this,"currentFrame");i(this,"maxRadius");this.maxRadius=30*e,this.x=s,this.y=t,this.particles=[],this.duration=h.EXPLOSION.DURATION,this.currentFrame=0;const a=Math.floor(50*e);for(let o=0;o<a;o++){const n=Math.random()*Math.PI*2,c=Math.random()*this.maxRadius;this.particles.push({x:this.x+Math.cos(n)*c*Math.random(),y:this.y+Math.sin(n)*c*Math.random(),radius:Math.random()*4+1,speed:Math.random()*100+25,angle:n,color:this.getExplosionColor()})}}getExplosionColor(){const s=Math.random()*60+10,t=100,e=50+Math.random()*30;return`hsl(${s}, ${t}%, ${e}%)`}update(s){this.currentFrame++;const t=this.currentFrame/this.duration;this.particles.forEach(e=>{const a=t<.2?1:1-(t-.2)/.8;e.x+=Math.cos(e.angle)*e.speed*s*a,e.y+=Math.sin(e.angle)*e.speed*s*a,e.radius*=.98,e.speed*=.98})}draw(s){const t=this.currentFrame/this.duration;this.particles.forEach(e=>{s.beginPath(),s.arc(e.x,e.y,e.radius,0,Math.PI*2),s.fillStyle=e.color,s.globalAlpha=Math.max(0,1-t**1.5),s.fill(),s.beginPath(),s.arc(e.x,e.y,e.radius*1.2,0,Math.PI*2),s.fillStyle="rgba(255, 255, 255, 0.2)",s.fill()}),s.globalAlpha=1}isFinished(){return this.currentFrame>=this.duration}}class v{constructor(){i(this,"x");i(this,"y");i(this,"width");i(this,"height");i(this,"color");i(this,"particles");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.width=Math.random()*200+100,this.height=Math.random()*200+100,this.color=`hsla(${Math.random()*360}, 70%, 50%, 0.2)`,this.particles=this.generateParticles()}generateParticles(){return Array(50).fill(null).map(()=>({x:(Math.random()-.5)*this.width,y:(Math.random()-.5)*this.height,radius:Math.random()*3+1,alpha:Math.random()*.5+.2}))}draw(s){s.save(),s.translate(this.x,this.y),s.fillStyle=this.color,s.beginPath(),s.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),s.fill(),s.fillStyle=this.color.replace("0.2","1"),this.particles.forEach(t=>{s.globalAlpha=t.alpha,s.beginPath(),s.arc(t.x,t.y,t.radius,0,Math.PI*2),s.fill()}),s.restore()}}class L{constructor(){i(this,"x");i(this,"y");i(this,"radius");i(this,"baseColor");i(this,"craters");i(this,"rotation");i(this,"rotationSpeed");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.radius=Math.random()*30+20,this.baseColor=`hsl(${Math.random()*360}, 50%, 50%)`,this.craters=this.generateCraters(),this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01}generateCraters(){const s=Math.floor(Math.random()*5)+3;return Array(s).fill(null).map(()=>({x:(Math.random()-.5)*this.radius*1.5,y:(Math.random()-.5)*this.radius*1.5,radius:Math.random()*(this.radius*.3)+this.radius*.1}))}update(s){this.rotation+=this.rotationSpeed*s}draw(s){s.save(),s.translate(this.x,this.y),s.rotate(this.rotation),s.fillStyle=this.baseColor,s.beginPath(),s.arc(0,0,this.radius,0,Math.PI*2),s.fill(),s.fillStyle="rgba(0, 0, 0, 0.2)",this.craters.forEach(t=>{s.beginPath(),s.arc(t.x,t.y,t.radius,0,Math.PI*2),s.fill()}),s.restore()}}class u extends d{constructor(s,t){super(s,t,h.BULLET.WIDTH,h.BULLET.HEIGHT)}update(s){this.y-=h.BULLET.SPEED*s}draw(s){s.fillStyle="#ff0000",s.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y+this.height>0}}class p extends d{constructor(t){super(h.CANVAS.WIDTH/2-h.PLAYER.WIDTH/2,h.CANVAS.HEIGHT-h.PLAYER.HEIGHT-10,h.PLAYER.WIDTH,h.PLAYER.HEIGHT);i(this,"velocity",{x:0,y:0});i(this,"health");i(this,"fireRate");i(this,"bulletType","single");i(this,"shieldActive",!1);i(this,"activePowerups",[]);i(this,"keys",{});i(this,"engineAnimationPhase",0);i(this,"invincible",!1);i(this,"lastHitTime",0);i(this,"lastFireTime",0);this.game=t,this.health=h.PLAYER.MAX_HEALTH,this.fireRate=h.PLAYER.FIRE_RATE}setKeyState(t,e){this.keys[t]=e}update(t){this.keys.ArrowLeft&&(this.velocity.x-=h.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=h.PLAYER.ACCELERATION),this.keys[" "]&&this.shoot(),this.move(t),this.updateInvincibility(),this.updateEngineAnimation(t)}move(t){if(this.keys.ArrowLeft&&(this.velocity.x-=h.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=h.PLAYER.ACCELERATION),this.velocity.x=Math.max(Math.min(this.velocity.x,h.PLAYER.MAX_SPEED),-h.PLAYER.MAX_SPEED),this.x+=this.velocity.x*t,this.x<0?(this.x=0,this.velocity.x=0):this.x+this.width>h.CANVAS.WIDTH&&(this.x=h.CANVAS.WIDTH-this.width,this.velocity.x=0),Math.abs(this.velocity.x)>0){const e=Math.sign(this.velocity.x)*-h.PLAYER.DECELERATION;this.velocity.x+=e,Math.abs(this.velocity.x)<h.PLAYER.DECELERATION&&(this.velocity.x=0)}}shoot(){const t=Date.now();t-this.lastFireTime>=this.fireRate&&(this.bulletType==="single"?this.game.addBullet(new u(this.x+this.width/2-h.BULLET.WIDTH/2,this.y)):this.bulletType==="triple"&&(this.game.addBullet(new u(this.x+this.width/2-h.BULLET.WIDTH/2,this.y)),this.game.addBullet(new u(this.x+this.width/2-h.BULLET.WIDTH/2-20,this.y+10)),this.game.addBullet(new u(this.x+this.width/2-h.BULLET.WIDTH/2+20,this.y+10))),this.lastFireTime=t)}takeDamage(t){!this.invincible&&!this.shieldActive&&(this.health=Math.max(0,this.health-t),this.invincible=!0,this.lastHitTime=Date.now(),this.health<=0&&this.game.gameOver())}updateInvincibility(){this.invincible&&Date.now()-this.lastHitTime>h.PLAYER.INVINCIBILITY_TIME&&(this.invincible=!1)}updateEngineAnimation(t){this.engineAnimationPhase+=h.PLAYER.ACCELERATION*t,this.engineAnimationPhase>Math.PI*2&&(this.engineAnimationPhase=0)}draw(t){t.fillStyle=this.invincible?"rgba(255, 0, 0, 0.5)":"#00ff00",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#0099ff",t.beginPath(),t.moveTo(this.x,this.y+this.height*.7),t.lineTo(this.x-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width*.3,this.y+this.height),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.x+this.width,this.y+this.height*.7),t.lineTo(this.x+this.width-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width+this.width*.3,this.y+this.height),t.closePath(),t.fill();const e=5+Math.sin(this.engineAnimationPhase)*2,a=t.createRadialGradient(this.x+this.width/2,this.y+this.height,0,this.x+this.width/2,this.y+this.height,e);a.addColorStop(0,"rgba(255, 255, 0, 1)"),a.addColorStop(1,"rgba(255, 100, 0, 0)"),t.fillStyle=a,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height,e,0,Math.PI*2),t.fill(),this.shieldActive&&(t.strokeStyle="rgba(0, 255, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2),t.stroke())}activatePowerup(t){h.POWERUP.TYPES[t].effect(this),this.activePowerups.push({type:t,startTime:Date.now()}),setTimeout(()=>this.deactivatePowerup(t),h.POWERUP.DURATION)}deactivatePowerup(t){switch(this.activePowerups=this.activePowerups.filter(e=>e.type!==t),t){case"RAPID_FIRE":this.fireRate=h.PLAYER.FIRE_RATE;break;case"TRIPLE_SHOT":this.bulletType="single";break;case"SHIELD":this.shieldActive=!1;break}}getHealth(){return this.health}setFireRate(t){this.fireRate=t}setBulletType(t){this.bulletType=t}activateShield(){this.shieldActive=!0}getPosition(){return{x:this.x,y:this.y}}}class D{constructor(){i(this,"x");i(this,"y");i(this,"size");i(this,"speed");i(this,"twinkleSpeed");i(this,"twinkleOffset");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.size=Math.random()*2+1,this.speed=Math.random()*10+5,this.twinkleSpeed=Math.random()*.05+.01,this.twinkleOffset=Math.random()*Math.PI*2}update(s){this.y+=this.speed*s,this.y>h.CANVAS.HEIGHT&&(this.y=0,this.x=Math.random()*h.CANVAS.WIDTH),this.twinkleOffset+=this.twinkleSpeed}draw(s){const t=Math.sin(this.twinkleOffset)*.5+.5;s.fillStyle=`rgba(255, 255, 255, ${.5+t*.5})`,s.beginPath(),s.arc(this.x,this.y,this.size*(.8+t*.2),0,Math.PI*2),s.fill()}}class H{constructor(){i(this,"events",{})}on(s,t){this.events[s]||(this.events[s]=[]),this.events[s].push(t)}off(s,t){this.events[s]&&(this.events[s]=this.events[s].filter(e=>e!==t))}emit(s,...t){this.events[s]&&this.events[s].forEach(e=>e(...t))}}class C{constructor(){i(this,"currentState",0)}setState(s){this.currentState=s}getState(){return this.currentState}isPlaying(){return this.currentState===1}}var l=(r=>(r[r.STARTING=0]="STARTING",r[r.PLAYING=1]="PLAYING",r[r.PAUSED=2]="PAUSED",r[r.GAME_OVER=3]="GAME_OVER",r))(l||{});class R extends H{constructor(){super();i(this,"canvas");i(this,"ctx");i(this,"player");i(this,"bullets",[]);i(this,"enemies",[]);i(this,"stars",[]);i(this,"explosions",[]);i(this,"planets",[]);i(this,"nebulas",[]);i(this,"powerups",[]);i(this,"boss",null);i(this,"bossBullets",[]);i(this,"level",1);i(this,"bossSpawnScore",1e3);i(this,"currentScore",0);i(this,"lastTime",0);i(this,"deltaTime",0);i(this,"stateManager",new C);i(this,"scoreManager",new g);i(this,"uiManager",new w);i(this,"difficultyFactor",0);i(this,"currentBossHealth",h.BOSS.INITIAL_HEALTH);i(this,"handleKeyDown",t=>{this.player.setKeyState(t.key,!0)});i(this,"handleKeyUp",t=>{this.player.setKeyState(t.key,!1)});i(this,"handleEnemyDestroyed",t=>{const e=t.getPosition(),a={x:e.x+t.getWidth()/2,y:e.y+t.getHeight()/2};this.explosions.push(new y(a)),this.scoreManager.addScore(t.getScore())});i(this,"handlePlayerDamaged",t=>{this.player.takeDamage(t),this.player.getHealth()<=0&&this.gameOver()});i(this,"handleBossDamaged",()=>{this.boss&&this.boss.takeDamage()&&this.emit("bossDefeated")});i(this,"handleBossDefeated",()=>{this.boss&&(this.explosions.push(new y(this.boss.getPosition())),this.boss=null,this.handleBossDefeat())});i(this,"handlePowerUpCollected",t=>{this.player.activatePowerup(t.getType())});i(this,"gameLoop",t=>{this.deltaTime=(t-this.lastTime)/1e3,this.lastTime=t,this.stateManager.isPlaying()&&(this.update(),this.draw()),requestAnimationFrame(this.gameLoop)});i(this,"spawnEnemy",()=>{if(this.stateManager.isPlaying()&&!this.boss){const t=Object.keys(h.ENEMY.TYPES),e=t[Math.floor(Math.random()*t.length)];this.enemies.push(E.createEnemy(e,this)),Math.random()<h.POWERUP.SPAWN_CHANCE&&this.powerups.push(E.createPowerUp())}});i(this,"restartGame",()=>{const t=document.getElementById("gameOver");t&&t.classList.add("hidden"),this.resetGame(),this.start()});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=h.CANVAS.WIDTH,this.canvas.height=h.CANVAS.HEIGHT,this.player=new p(this),this.initializeGameObjects(),this.setupEventListeners(),this.scoreManager.attach(this.uiManager),this.stateManager.setState(l.PLAYING)}initializeGameObjects(){this.stars=Array.from({length:h.BACKGROUND.STAR_COUNT},()=>new D),this.planets=Array.from({length:h.BACKGROUND.PLANET_COUNT},()=>new L),this.nebulas=Array.from({length:h.BACKGROUND.NEBULA_COUNT},()=>new v)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp);const t=document.getElementById("restartButton");t&&t.addEventListener("click",this.restartGame),this.on("enemyDestroyed",this.handleEnemyDestroyed),this.on("playerDamaged",this.handlePlayerDamaged),this.on("bossDamaged",this.handleBossDamaged),this.on("bossDefeated",this.handleBossDefeated),this.on("powerUpCollected",this.handlePowerUpCollected)}start(){this.gameLoop(0),setInterval(this.spawnEnemy,h.ENEMY.SPAWN_INTERVAL)}update(){this.player.update(this.deltaTime),this.updateGameObjects(),this.checkCollisions(),this.removeOffscreenObjects(),this.uiManager.updateHealthDisplay(this.player.getHealth()),this.uiManager.updateLevelDisplay(this.level)}updateGameObjects(){const t=[...this.bullets,...this.enemies,...this.powerups,...this.explosions,...this.stars,...this.planets,...this.bossBullets];this.boss&&t.push(this.boss),t.forEach(e=>e.update(this.deltaTime)),this.currentScore=this.scoreManager.getScore(),this.currentScore>=this.bossSpawnScore&&!this.boss&&this.spawnBoss()}spawnBoss(){this.boss=new b(this),this.showMessage("ボスが出現しました！")}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions(),this.checkPlayerPowerupCollisions(),this.boss&&this.checkBossBattleCollisions()}checkBulletEnemyCollisions(){for(let t=this.bullets.length-1;t>=0;t--)for(let e=this.enemies.length-1;e>=0;e--)if(this.checkCollision(this.bullets[t],this.enemies[e])){this.bullets.splice(t,1),this.enemies[e].takeDamage()&&(this.emit("enemyDestroyed",this.enemies[e]),this.enemies.splice(e,1));break}}checkPlayerEnemyCollisions(){for(let t=this.enemies.length-1;t>=0;t--)this.checkCollision(this.player,this.enemies[t])&&(this.emit("playerDamaged",20),this.emit("enemyDestroyed",this.enemies[t]),this.enemies.splice(t,1))}checkPlayerPowerupCollisions(){for(let t=this.powerups.length-1;t>=0;t--)this.checkCollision(this.player,this.powerups[t])&&(this.emit("powerUpCollected",this.powerups[t]),this.powerups.splice(t,1))}checkBossBattleCollisions(){this.boss&&this.checkCollision(this.player,this.boss)&&this.emit("playerDamaged",20);for(let t=this.bullets.length-1;t>=0;t--)this.boss&&this.checkCollision(this.bullets[t],this.boss)&&(this.bullets.splice(t,1),this.emit("bossDamaged"));for(let t=this.bossBullets.length-1;t>=0;t--)this.checkCollision(this.player,this.bossBullets[t])&&(this.emit("playerDamaged",20),this.bossBullets.splice(t,1))}removeOffscreenObjects(){this.bullets=this.bullets.filter(t=>t.isOnScreen()),this.enemies=this.enemies.filter(t=>t.isOnScreen()),this.powerups=this.powerups.filter(t=>t.isOnScreen()),this.explosions=this.explosions.filter(t=>!t.isFinished()),this.bossBullets=this.bossBullets.filter(t=>t.isOnScreen())}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,h.CANVAS.HEIGHT);t.addColorStop(0,"#000033"),t.addColorStop(1,"#000066"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,h.CANVAS.WIDTH,h.CANVAS.HEIGHT),this.nebulas.forEach(e=>e.draw(this.ctx)),this.planets.forEach(e=>e.draw(this.ctx)),this.stars.forEach(e=>e.draw(this.ctx)),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(50,50),this.ctx.lineTo(100,100),this.ctx.lineTo(150,75),this.ctx.lineTo(200,150),this.ctx.stroke()}draw(){this.drawBackground(),this.player.draw(this.ctx),this.bullets.forEach(t=>t.draw(this.ctx)),this.enemies.forEach(t=>t.draw(this.ctx)),this.powerups.forEach(t=>t.draw(this.ctx)),this.explosions.forEach(t=>t.draw(this.ctx)),this.boss&&(this.boss.draw(this.ctx),this.bossBullets.forEach(t=>t.draw(this.ctx)))}checkCollision(t,e){return t.getX()<e.getX()+e.getWidth()&&t.getX()+t.getWidth()>e.getX()&&t.getY()<e.getY()+e.getHeight()&&t.getY()+t.getHeight()>e.getY()}gameOver(){this.stateManager.setState(l.GAME_OVER);const t=document.getElementById("gameOver");t&&t.classList.remove("hidden");const e=document.getElementById("finalScore");e&&(e.textContent=this.scoreManager.getScore().toString())}resetGame(){this.player=new p(this),this.bullets=[],this.enemies=[],this.powerups=[],this.explosions=[],this.boss=null,this.bossBullets=[],this.level=1,this.bossSpawnScore=1e3,this.scoreManager=new g,this.scoreManager.attach(this.uiManager),this.stateManager.setState(l.PLAYING)}handleBossDefeat(){this.scoreManager.addScore(500),this.showMessage(`レベル ${this.level} クリア！次のレベルが始まります。`),this.level++,this.uiManager.updateLevelDisplay(this.level),setTimeout(()=>{this.startNextLevel()},3e3),this.bossSpawnScore=this.currentScore+1e3}startNextLevel(){this.enemies=[],this.bossBullets=[],this.powerups=[],this.difficultyFactor=this.level*.1,this.currentBossHealth=h.BOSS.INITIAL_HEALTH+(this.level-1)*10,this.bossSpawnScore=this.scoreManager.getScore()+1e3,this.showMessage(`レベル ${this.level} 開始！`)}showMessage(t){const e=document.createElement("div");e.textContent=t,e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.color="white",e.style.fontSize="24px",e.style.textAlign="center",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3)}addBullet(t){this.bullets.push(t)}addBossBullet(t){this.bossBullets.push(t)}pauseGame(){this.stateManager.setState(l.PAUSED)}resumeGame(){this.stateManager.setState(l.PLAYING)}getDifficultyFactor(){return this.difficultyFactor}getCurrentBossHealth(){return this.currentBossHealth}}let P;function O(){P=new R,P.start()}document.addEventListener("DOMContentLoaded",O);
