var S=Object.defineProperty;var T=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>T(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&h(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const i={CANVAS:{WIDTH:400,HEIGHT:600},PLAYER:{WIDTH:50,HEIGHT:50,MAX_SPEED:128,ACCELERATION:3,DECELERATION:2,MAX_HEALTH:100,INVINCIBILITY_TIME:1e3,FIRE_RATE:200},BULLET:{WIDTH:5,HEIGHT:15,SPEED:600},ENEMY:{SPAWN_INTERVAL:1e3,TYPES:{SMALL:{width:30,height:30,speed:180,health:1,score:10,color:"#ff00ff"},MEDIUM:{width:50,height:50,speed:120,health:2,score:20,color:"#00ffff"},LARGE:{width:70,height:70,speed:60,health:3,score:30,color:"#ffff00"}}},BOSS:{WIDTH:150,HEIGHT:150,BULLET_SPEED:200,FIRE_RATE:1e3,INITIAL_HEALTH:50,INITIAL_SPEED:50,MOVEMENT_SPEED:50},POWERUP:{WIDTH:30,HEIGHT:30,SPEED:100,DURATION:1e4,SPAWN_CHANCE:.05,TYPES:{RAPID_FIRE:{color:"#00ff00",effect:r=>{r.setFireRate(i.PLAYER.FIRE_RATE/2)}},TRIPLE_SHOT:{color:"#0000ff",effect:r=>{r.setBulletType("triple")}},SHIELD:{color:"#ffff00",effect:r=>{r.activateShield()}}}},EXPLOSION:{DURATION:30},BACKGROUND:{STAR_COUNT:100,PLANET_COUNT:2,NEBULA_COUNT:1}};class d{constructor(e,t,h,a){this.x=e,this.y=t,this.width=h,this.height=a}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}}class A extends d{constructor(t,h,a,o){const n=i.ENEMY.TYPES[t];super(h,a,n.width,n.height);s(this,"type");s(this,"speed");s(this,"health");s(this,"score");s(this,"color");s(this,"movementPattern");s(this,"movementTimer",0);s(this,"game");s(this,"animationPhase",0);s(this,"subEntities",[]);if(this.type=t,this.speed=n.speed,this.health=n.health,this.score=n.score,this.color=n.color,this.movementPattern=this.getMovementPatternForType(),this.game=o,t==="MEDIUM"){const c=3+Math.floor(Math.random()*3);for(let m=0;m<c;m++)this.subEntities.push({x:(Math.random()-.5)*this.width*.8,y:(Math.random()-.5)*this.height*.8,radius:this.width*(.1+Math.random()*.1)})}}getMovementPatternForType(){switch(this.type){case"SMALL":return"zigzag";case"MEDIUM":return"sine";case"LARGE":return"straight";default:return"straight"}}update(t){const h=1+this.game.getDifficultyFactor();switch(this.y+=this.speed*h*t,this.movementTimer+=3*t,this.movementPattern){case"zigzag":this.x+=Math.sin(this.movementTimer*2)*2;break;case"sine":this.x+=Math.sin(this.movementTimer)*1.5;break}(this.x<0||this.x+this.width>i.CANVAS.WIDTH)&&(this.movementPattern="straight"),this.animationPhase+=t*2,this.type==="MEDIUM"&&this.subEntities.forEach(a=>{a.x+=Math.sin(this.animationPhase+a.y)*.5,a.y+=Math.cos(this.animationPhase+a.x)*.5})}draw(t){switch(t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),this.type){case"SMALL":this.drawSmallUMA(t);break;case"MEDIUM":this.drawMediumUMA(t);break;case"LARGE":this.drawLargeUMA(t);break}t.restore()}drawSmallUMA(t){const h=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<12;a++){const o=a/12*Math.PI*2,n=h*(.8+Math.sin(this.animationPhase+a)*.2);t.lineTo(Math.cos(o)*n,Math.sin(o)*n)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.beginPath(),t.arc(0,0,h*.3,0,Math.PI*2),t.fill(),t.strokeStyle=this.color,t.lineWidth=2;for(let a=0;a<5;a++){const o=a/5*Math.PI*2+this.animationPhase;t.beginPath(),t.moveTo(Math.cos(o)*h*.8,Math.sin(o)*h*.8),t.lineTo(Math.cos(o)*h*1.2,Math.sin(o)*h*1.2),t.stroke()}}drawMediumUMA(t){const h=this.width/2;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,h,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=2;for(let a=0;a<8;a++){const o=a/8*Math.PI*2,n=h*(1+Math.sin(this.animationPhase+a)*.2);t.beginPath(),t.moveTo(Math.cos(o)*h,Math.sin(o)*h),t.lineTo(Math.cos(o)*n,Math.sin(o)*n),t.stroke()}this.subEntities.forEach(a=>{t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(a.x,a.y,a.radius,0,Math.PI*2),t.fill()})}drawLargeUMA(t){const h=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<6;a++){const o=a/6*Math.PI*2,n=h*(1+Math.cos(this.animationPhase+a)*.1);t.lineTo(Math.cos(o)*n,Math.sin(o)*n)}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=3;for(let a=0;a<6;a++){const o=a/6*Math.PI*2,n=h*(1.2+Math.sin(this.animationPhase+a)*.3);t.beginPath(),t.moveTo(Math.cos(o)*h,Math.sin(o)*h),t.lineTo(Math.cos(o)*n,Math.sin(o)*n),t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(0,0,h*.3,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2;for(let a=0;a<3;a++)t.beginPath(),t.arc(0,0,h*(.5+a*.2),0,Math.PI*2),t.stroke()}takeDamage(){return this.health--,this.health<=0}getScore(){return this.score}isOnScreen(){return this.y<i.CANVAS.HEIGHT}getPosition(){return{x:this.x,y:this.y}}getType(){return this.type}}class M extends d{constructor(t,h){super(t,h,i.POWERUP.WIDTH,i.POWERUP.HEIGHT);s(this,"type");s(this,"color");s(this,"rotation",0);s(this,"rotationSpeed");this.type=this.getRandomPowerUpType(),this.color=i.POWERUP.TYPES[this.type].color,this.rotationSpeed=Math.random()*.1+.05}getRandomPowerUpType(){const t=Object.keys(i.POWERUP.TYPES);return t[Math.floor(Math.random()*t.length)]}update(t){this.y+=i.POWERUP.SPEED*t,this.rotation+=this.rotationSpeed*t}draw(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation),t.beginPath(),t.arc(0,0,this.width/2,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),t.beginPath(),t.arc(0,0,this.width/3,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle";let h;switch(this.type){case"RAPID_FIRE":h="R";break;case"TRIPLE_SHOT":h="T";break;case"SHIELD":h="S";break}t.fillText(h,0,0),t.restore()}isOnScreen(){return this.y<i.CANVAS.HEIGHT}getType(){return this.type}}function E(r,e){return Math.random()*(e-r)+r}class y{static createEnemy(e,t){const h=i.ENEMY.TYPES[e],a=E(0,i.CANVAS.WIDTH-h.width);return new A(e,a,-h.height,t)}static createPowerUp(){const e=E(0,i.CANVAS.WIDTH-i.POWERUP.WIDTH);return new M(e,-i.POWERUP.HEIGHT)}}class f{constructor(){s(this,"observers",[]);s(this,"score",0)}attach(e){this.observers.includes(e)||this.observers.push(e)}detach(e){const t=this.observers.indexOf(e);t!==-1&&this.observers.splice(t,1)}notify(){for(const e of this.observers)e.update(this)}getScore(){return this.score}addScore(e){this.score+=e,this.notify()}}class w{constructor(){s(this,"scoreElement");s(this,"levelElement");s(this,"healthElement");s(this,"healthBarElement");this.scoreElement=document.getElementById("scoreValue"),this.levelElement=document.getElementById("levelValue"),this.healthElement=document.getElementById("healthValue"),this.healthBarElement=document.getElementById("healthBarFill")}update(e){e instanceof f&&this.updateScoreDisplay(e.getScore())}updateScoreDisplay(e){this.scoreElement&&(this.scoreElement.textContent=e.toString())}updateLevelDisplay(e){this.levelElement&&(this.levelElement.textContent=e.toString())}updateHealthDisplay(e){if(this.healthElement&&(this.healthElement.textContent=e.toString()),this.healthBarElement){const t=e/i.PLAYER.MAX_HEALTH*100;this.healthBarElement.style.width=`${t}%`}}}class I extends d{constructor(t,h,a,o){super(t,h,i.BULLET.WIDTH,i.BULLET.HEIGHT);s(this,"speedX");s(this,"speedY");this.speedX=a,this.speedY=o}update(t){this.x+=this.speedX*t,this.y+=this.speedY*t}draw(t){t.fillStyle="#ff00ff",t.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y<i.CANVAS.HEIGHT&&this.y>0&&this.x<i.CANVAS.WIDTH&&this.x>0}}class b extends d{constructor(t){super(i.CANVAS.WIDTH/2-i.BOSS.WIDTH/2,-i.BOSS.HEIGHT,i.BOSS.WIDTH,i.BOSS.HEIGHT);s(this,"health");s(this,"moveDirection",1);s(this,"lastFireTime",0);s(this,"game");this.health=t.getCurrentBossHealth(),this.game=t}update(t){if(this.y<50)this.y+=i.BOSS.INITIAL_SPEED*t;else{const a=this.x+this.moveDirection*i.BOSS.MOVEMENT_SPEED*t;a<=0?(this.x=0,this.moveDirection=1):a+this.width>=i.CANVAS.WIDTH?(this.x=i.CANVAS.WIDTH-this.width,this.moveDirection=-1):this.x=a}const h=Date.now();h-this.lastFireTime>i.BOSS.FIRE_RATE&&(this.shoot(),this.lastFireTime=h)}shoot(){const t=Math.PI/8;for(let h=-1;h<=1;h++){const a=h*t,o=Math.sin(a)*i.BOSS.BULLET_SPEED,n=Math.cos(a)*i.BOSS.BULLET_SPEED;this.game.addBossBullet(new I(this.x+this.width/2,this.y+this.height,o,n))}}draw(t){t.fillStyle="#ff0000",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.fill();const h=this.health/i.BOSS.INITIAL_HEALTH;t.fillStyle="#00ff00",t.fillRect(this.x,this.y-20,this.width*h,10),t.strokeStyle="#ffffff",t.strokeRect(this.x,this.y-20,this.width,10)}takeDamage(){return this.health--,this.health<=0}getPosition(){return{x:this.x,y:this.y}}}class g{constructor({x:e,y:t},h=1){s(this,"x");s(this,"y");s(this,"particles");s(this,"duration");s(this,"currentFrame");s(this,"maxRadius");this.maxRadius=30*h,this.x=e,this.y=t,this.particles=[],this.duration=i.EXPLOSION.DURATION,this.currentFrame=0;const a=Math.floor(50*h);for(let o=0;o<a;o++){const n=Math.random()*Math.PI*2,c=Math.random()*this.maxRadius;this.particles.push({x:this.x+Math.cos(n)*c*Math.random(),y:this.y+Math.sin(n)*c*Math.random(),radius:Math.random()*4+1,speed:Math.random()*100+25,angle:n,color:this.getExplosionColor()})}}getExplosionColor(){const e=Math.random()*60+10,t=100,h=50+Math.random()*30;return`hsl(${e}, ${t}%, ${h}%)`}update(e){this.currentFrame++;const t=this.currentFrame/this.duration;this.particles.forEach(h=>{const a=t<.2?1:1-(t-.2)/.8;h.x+=Math.cos(h.angle)*h.speed*e*a,h.y+=Math.sin(h.angle)*h.speed*e*a,h.radius*=.98,h.speed*=.98})}draw(e){const t=this.currentFrame/this.duration;this.particles.forEach(h=>{e.beginPath(),e.arc(h.x,h.y,h.radius,0,Math.PI*2),e.fillStyle=h.color,e.globalAlpha=Math.max(0,1-t**1.5),e.fill(),e.beginPath(),e.arc(h.x,h.y,h.radius*1.2,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill()}),e.globalAlpha=1}isFinished(){return this.currentFrame>=this.duration}}class L{constructor(){s(this,"x");s(this,"y");s(this,"width");s(this,"height");s(this,"color");s(this,"particles");this.x=Math.random()*i.CANVAS.WIDTH,this.y=Math.random()*i.CANVAS.HEIGHT,this.width=Math.random()*200+100,this.height=Math.random()*200+100,this.color=`hsla(${Math.random()*360}, 70%, 50%, 0.2)`,this.particles=this.generateParticles()}generateParticles(){return Array(50).fill(null).map(()=>({x:(Math.random()-.5)*this.width,y:(Math.random()-.5)*this.height,radius:Math.random()*3+1,alpha:Math.random()*.5+.2}))}draw(e){e.save(),e.translate(this.x,this.y),e.fillStyle=this.color,e.beginPath(),e.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),e.fill(),e.fillStyle=this.color.replace("0.2","1"),this.particles.forEach(t=>{e.globalAlpha=t.alpha,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class v{constructor(){s(this,"x");s(this,"y");s(this,"radius");s(this,"baseColor");s(this,"craters");s(this,"rotation");s(this,"rotationSpeed");this.x=Math.random()*i.CANVAS.WIDTH,this.y=Math.random()*i.CANVAS.HEIGHT,this.radius=Math.random()*30+20,this.baseColor=`hsl(${Math.random()*360}, 50%, 50%)`,this.craters=this.generateCraters(),this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01}generateCraters(){const e=Math.floor(Math.random()*5)+3;return Array(e).fill(null).map(()=>({x:(Math.random()-.5)*this.radius*1.5,y:(Math.random()-.5)*this.radius*1.5,radius:Math.random()*(this.radius*.3)+this.radius*.1}))}update(e){this.rotation+=this.rotationSpeed*e}draw(e){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle=this.baseColor,e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.2)",this.craters.forEach(t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class u extends d{constructor(e,t){super(e,t,i.BULLET.WIDTH,i.BULLET.HEIGHT)}update(e){this.y-=i.BULLET.SPEED*e}draw(e){e.fillStyle="#ff0000",e.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y+this.height>0}}class p extends d{constructor(t){super(i.CANVAS.WIDTH/2-i.PLAYER.WIDTH/2,i.CANVAS.HEIGHT-i.PLAYER.HEIGHT-10,i.PLAYER.WIDTH,i.PLAYER.HEIGHT);s(this,"velocity",{x:0,y:0});s(this,"health");s(this,"fireRate");s(this,"bulletType","single");s(this,"shieldActive",!1);s(this,"activePowerups",[]);s(this,"keys",{});s(this,"engineAnimationPhase",0);s(this,"invincible",!1);s(this,"lastHitTime",0);s(this,"lastFireTime",0);this.game=t,this.health=i.PLAYER.MAX_HEALTH,this.fireRate=i.PLAYER.FIRE_RATE}setKeyState(t,h){this.keys[t]=h}update(t){this.keys.ArrowLeft&&(this.velocity.x-=i.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=i.PLAYER.ACCELERATION),this.keys[" "]&&this.shoot(),this.move(t),this.updateInvincibility(),this.updateEngineAnimation(t)}move(t){if(this.keys.ArrowLeft&&(this.velocity.x-=i.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=i.PLAYER.ACCELERATION),this.velocity.x=Math.max(Math.min(this.velocity.x,i.PLAYER.MAX_SPEED),-i.PLAYER.MAX_SPEED),this.x+=this.velocity.x*t,this.x<0?(this.x=0,this.velocity.x=0):this.x+this.width>i.CANVAS.WIDTH&&(this.x=i.CANVAS.WIDTH-this.width,this.velocity.x=0),Math.abs(this.velocity.x)>0){const h=Math.sign(this.velocity.x)*-i.PLAYER.DECELERATION;this.velocity.x+=h,Math.abs(this.velocity.x)<i.PLAYER.DECELERATION&&(this.velocity.x=0)}}shoot(){const t=Date.now();t-this.lastFireTime>=this.fireRate&&(this.bulletType==="single"?this.game.addBullet(new u(this.x+this.width/2-i.BULLET.WIDTH/2,this.y)):this.bulletType==="triple"&&(this.game.addBullet(new u(this.x+this.width/2-i.BULLET.WIDTH/2,this.y)),this.game.addBullet(new u(this.x+this.width/2-i.BULLET.WIDTH/2-20,this.y+10)),this.game.addBullet(new u(this.x+this.width/2-i.BULLET.WIDTH/2+20,this.y+10))),this.lastFireTime=t)}takeDamage(t){!this.invincible&&!this.shieldActive&&(this.health=Math.max(0,this.health-t),this.invincible=!0,this.lastHitTime=Date.now(),this.health<=0&&this.game.gameOver())}updateInvincibility(){this.invincible&&Date.now()-this.lastHitTime>i.PLAYER.INVINCIBILITY_TIME&&(this.invincible=!1)}updateEngineAnimation(t){this.engineAnimationPhase+=i.PLAYER.ACCELERATION*t,this.engineAnimationPhase>Math.PI*2&&(this.engineAnimationPhase=0)}draw(t){t.fillStyle=this.invincible?"rgba(255, 0, 0, 0.5)":"#00ff00",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#0099ff",t.beginPath(),t.moveTo(this.x,this.y+this.height*.7),t.lineTo(this.x-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width*.3,this.y+this.height),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.x+this.width,this.y+this.height*.7),t.lineTo(this.x+this.width-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width+this.width*.3,this.y+this.height),t.closePath(),t.fill();const h=5+Math.sin(this.engineAnimationPhase)*2,a=t.createRadialGradient(this.x+this.width/2,this.y+this.height,0,this.x+this.width/2,this.y+this.height,h);a.addColorStop(0,"rgba(255, 255, 0, 1)"),a.addColorStop(1,"rgba(255, 100, 0, 0)"),t.fillStyle=a,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height,h,0,Math.PI*2),t.fill(),this.shieldActive&&(t.strokeStyle="rgba(0, 255, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2),t.stroke())}activatePowerup(t){i.POWERUP.TYPES[t].effect(this),this.activePowerups.push({type:t,startTime:Date.now()}),setTimeout(()=>this.deactivatePowerup(t),i.POWERUP.DURATION)}deactivatePowerup(t){switch(this.activePowerups=this.activePowerups.filter(h=>h.type!==t),t){case"RAPID_FIRE":this.fireRate=i.PLAYER.FIRE_RATE;break;case"TRIPLE_SHOT":this.bulletType="single";break;case"SHIELD":this.shieldActive=!1;break}}getHealth(){return this.health}setFireRate(t){this.fireRate=t}setBulletType(t){this.bulletType=t}activateShield(){this.shieldActive=!0}getPosition(){return{x:this.x,y:this.y}}}class H{constructor(){s(this,"x");s(this,"y");s(this,"size");s(this,"speed");s(this,"twinkleSpeed");s(this,"twinkleOffset");this.x=Math.random()*i.CANVAS.WIDTH,this.y=Math.random()*i.CANVAS.HEIGHT,this.size=Math.random()*2+1,this.speed=Math.random()*10+5,this.twinkleSpeed=Math.random()*.05+.01,this.twinkleOffset=Math.random()*Math.PI*2}update(e){this.y+=this.speed*e,this.y>i.CANVAS.HEIGHT&&(this.y=0,this.x=Math.random()*i.CANVAS.WIDTH),this.twinkleOffset+=this.twinkleSpeed}draw(e){const t=Math.sin(this.twinkleOffset)*.5+.5;e.fillStyle=`rgba(255, 255, 255, ${.5+t*.5})`,e.beginPath(),e.arc(this.x,this.y,this.size*(.8+t*.2),0,Math.PI*2),e.fill()}}class D{constructor(){s(this,"currentState",0)}setState(e){this.currentState=e}getState(){return this.currentState}isPlaying(){return this.currentState===1}}var l=(r=>(r[r.STARTING=0]="STARTING",r[r.PLAYING=1]="PLAYING",r[r.PAUSED=2]="PAUSED",r[r.GAME_OVER=3]="GAME_OVER",r))(l||{});class R{constructor(){s(this,"canvas");s(this,"ctx");s(this,"player");s(this,"bullets",[]);s(this,"enemies",[]);s(this,"stars",[]);s(this,"explosions",[]);s(this,"planets",[]);s(this,"nebulas",[]);s(this,"powerups",[]);s(this,"boss",null);s(this,"bossBullets",[]);s(this,"level",1);s(this,"bossSpawnScore",1e3);s(this,"currentScore",0);s(this,"lastTime",0);s(this,"deltaTime",0);s(this,"stateManager",new D);s(this,"scoreManager",new f);s(this,"uiManager",new w);s(this,"difficultyFactor",0);s(this,"currentBossHealth",i.BOSS.INITIAL_HEALTH);s(this,"handleKeyDown",e=>{this.player.setKeyState(e.key,!0)});s(this,"handleKeyUp",e=>{this.player.setKeyState(e.key,!1)});s(this,"gameLoop",e=>{this.deltaTime=(e-this.lastTime)/1e3,this.lastTime=e,this.stateManager.isPlaying()&&(this.update(),this.draw()),requestAnimationFrame(this.gameLoop)});s(this,"spawnEnemy",()=>{if(this.stateManager.isPlaying()&&!this.boss){const e=Object.keys(i.ENEMY.TYPES),t=e[Math.floor(Math.random()*e.length)];this.enemies.push(y.createEnemy(t,this)),Math.random()<i.POWERUP.SPAWN_CHANCE&&this.powerups.push(y.createPowerUp())}});s(this,"restartGame",()=>{const e=document.getElementById("gameOver");e&&e.classList.add("hidden"),this.resetGame(),this.start()});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=i.CANVAS.WIDTH,this.canvas.height=i.CANVAS.HEIGHT,this.player=new p(this),this.initializeGameObjects(),this.setupEventListeners(),this.scoreManager.attach(this.uiManager),this.stateManager.setState(l.PLAYING)}initializeGameObjects(){this.stars=Array.from({length:i.BACKGROUND.STAR_COUNT},()=>new H),this.planets=Array.from({length:i.BACKGROUND.PLANET_COUNT},()=>new v),this.nebulas=Array.from({length:i.BACKGROUND.NEBULA_COUNT},()=>new L)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp);const e=document.getElementById("restartButton");e&&e.addEventListener("click",this.restartGame)}start(){this.gameLoop(0),setInterval(this.spawnEnemy,i.ENEMY.SPAWN_INTERVAL)}update(){this.player.update(this.deltaTime),this.updateGameObjects(),this.checkCollisions(),this.removeOffscreenObjects(),this.uiManager.updateHealthDisplay(this.player.getHealth()),this.uiManager.updateLevelDisplay(this.level)}updateGameObjects(){const e=[...this.bullets,...this.enemies,...this.powerups,...this.explosions,...this.stars,...this.planets,...this.bossBullets];this.boss&&e.push(this.boss),e.forEach(t=>t.update(this.deltaTime)),this.currentScore=this.scoreManager.getScore(),this.currentScore>=this.bossSpawnScore&&!this.boss&&this.spawnBoss()}spawnBoss(){this.boss=new b(this),this.showMessage("ボスが出現しました！")}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions(),this.checkPlayerPowerupCollisions(),this.boss&&this.checkBossBattleCollisions()}checkBulletEnemyCollisions(){for(let e=this.bullets.length-1;e>=0;e--)for(let t=this.enemies.length-1;t>=0;t--)if(this.checkCollision(this.bullets[e],this.enemies[t])){if(this.bullets.splice(e,1),this.enemies[t].takeDamage()){const h=this.enemies[t].getPosition(),a={x:h.x+this.enemies[t].getWidth()/2,y:h.y+this.enemies[t].getHeight()/2};this.explosions.push(new g(a)),this.scoreManager.addScore(this.enemies[t].getScore()),this.enemies.splice(t,1)}break}}checkPlayerEnemyCollisions(){for(let e=this.enemies.length-1;e>=0;e--)this.checkCollision(this.player,this.enemies[e])&&(this.player.takeDamage(20),this.explosions.push(new g(this.enemies[e].getPosition())),this.enemies.splice(e,1))}checkPlayerPowerupCollisions(){for(let e=this.powerups.length-1;e>=0;e--)this.checkCollision(this.player,this.powerups[e])&&(this.player.activatePowerup(this.powerups[e].getType()),this.powerups.splice(e,1))}checkBossBattleCollisions(){this.boss&&this.checkCollision(this.player,this.boss)&&this.player.takeDamage(20);for(let e=this.bullets.length-1;e>=0;e--)this.boss&&this.checkCollision(this.bullets[e],this.boss)&&(this.bullets.splice(e,1),this.boss.takeDamage()&&(this.explosions.push(new g(this.boss.getPosition())),this.boss=null,this.handleBossDefeat()));for(let e=this.bossBullets.length-1;e>=0;e--)this.checkCollision(this.player,this.bossBullets[e])&&(this.player.takeDamage(20),this.bossBullets.splice(e,1))}removeOffscreenObjects(){this.bullets=this.bullets.filter(e=>e.isOnScreen()),this.enemies=this.enemies.filter(e=>e.isOnScreen()),this.powerups=this.powerups.filter(e=>e.isOnScreen()),this.explosions=this.explosions.filter(e=>!e.isFinished()),this.bossBullets=this.bossBullets.filter(e=>e.isOnScreen())}drawBackground(){const e=this.ctx.createLinearGradient(0,0,0,i.CANVAS.HEIGHT);e.addColorStop(0,"#000033"),e.addColorStop(1,"#000066"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,i.CANVAS.WIDTH,i.CANVAS.HEIGHT),this.nebulas.forEach(t=>t.draw(this.ctx)),this.planets.forEach(t=>t.draw(this.ctx)),this.stars.forEach(t=>t.draw(this.ctx)),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(50,50),this.ctx.lineTo(100,100),this.ctx.lineTo(150,75),this.ctx.lineTo(200,150),this.ctx.stroke()}draw(){this.drawBackground(),this.player.draw(this.ctx),this.bullets.forEach(e=>e.draw(this.ctx)),this.enemies.forEach(e=>e.draw(this.ctx)),this.powerups.forEach(e=>e.draw(this.ctx)),this.explosions.forEach(e=>e.draw(this.ctx)),this.boss&&(this.boss.draw(this.ctx),this.bossBullets.forEach(e=>e.draw(this.ctx)))}checkCollision(e,t){return e.getX()<t.getX()+t.getWidth()&&e.getX()+e.getWidth()>t.getX()&&e.getY()<t.getY()+t.getHeight()&&e.getY()+e.getHeight()>t.getY()}gameOver(){this.stateManager.setState(l.GAME_OVER);const e=document.getElementById("gameOver");e&&e.classList.remove("hidden");const t=document.getElementById("finalScore");t&&(t.textContent=this.scoreManager.getScore().toString())}resetGame(){this.player=new p(this),this.bullets=[],this.enemies=[],this.powerups=[],this.explosions=[],this.boss=null,this.bossBullets=[],this.level=1,this.bossSpawnScore=1e3,this.scoreManager=new f,this.scoreManager.attach(this.uiManager),this.stateManager.setState(l.PLAYING)}handleBossDefeat(){this.scoreManager.addScore(500),this.level++,this.uiManager.updateLevelDisplay(this.level),this.showMessage(`レベル ${this.level} クリア！次のレベルが始まります。`),setTimeout(()=>{this.startNextLevel()},3e3),this.bossSpawnScore=this.currentScore+1e3}startNextLevel(){this.enemies=[],this.bossBullets=[],this.powerups=[],this.difficultyFactor=this.level*.1,this.currentBossHealth=i.BOSS.INITIAL_HEALTH+(this.level-1)*10,this.bossSpawnScore=this.scoreManager.getScore()+1e3,this.showMessage(`レベル ${this.level} 開始！`)}showMessage(e){const t=document.createElement("div");t.textContent=e,t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="white",t.style.fontSize="24px",t.style.textAlign="center",document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},3e3)}addBullet(e){this.bullets.push(e)}addBossBullet(e){this.bossBullets.push(e)}pauseGame(){this.stateManager.setState(l.PAUSED)}resumeGame(){this.stateManager.setState(l.PLAYING)}getDifficultyFactor(){return this.difficultyFactor}getCurrentBossHealth(){return this.currentBossHealth}}let P;function C(){P=new R,P.start()}document.addEventListener("DOMContentLoaded",C);
