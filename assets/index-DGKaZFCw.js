var S=Object.defineProperty;var A=(o,e,t)=>e in o?S(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>A(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const h={CANVAS:{WIDTH:400,HEIGHT:600},PLAYER:{WIDTH:50,HEIGHT:50,MAX_SPEED:128,ACCELERATION:3,DECELERATION:2,MAX_HEALTH:100,INVINCIBILITY_TIME:1e3,FIRE_RATE:200},BULLET:{WIDTH:5,HEIGHT:15,SPEED:600},ENEMY:{SPAWN_INTERVAL:1e3,TYPES:{SMALL:{width:30,height:30,speed:180,health:1,score:10,color:"#ff00ff"},MEDIUM:{width:50,height:50,speed:120,health:2,score:20,color:"#00ffff"},LARGE:{width:70,height:70,speed:60,health:3,score:30,color:"#ffff00"}}},BOSS:{WIDTH:150,HEIGHT:150,BULLET_SPEED:200,FIRE_RATE:1e3,INITIAL_HEALTH:50,INITIAL_SPEED:50,MOVEMENT_SPEED:50},POWERUP:{WIDTH:30,HEIGHT:30,SPEED:100,DURATION:1e4,SPAWN_CHANCE:.05,TYPES:{RAPID_FIRE:{color:"#00ff00",effect:o=>{o.setFireRate(h.PLAYER.FIRE_RATE/2)}},TRIPLE_SHOT:{color:"#0000ff",effect:o=>{o.setBulletType("triple")}},SHIELD:{color:"#ffff00",effect:o=>{o.activateShield()}}}},EXPLOSION:{DURATION:30},BACKGROUND:{STAR_COUNT:100,PLANET_COUNT:2,NEBULA_COUNT:1}};class c{constructor(e,t,s,a){this.x=e,this.y=t,this.width=s,this.height=a}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}}class T extends c{constructor(t,s,a,r){const n=h.ENEMY.TYPES[t];super(s,a,n.width,n.height);i(this,"type");i(this,"speed");i(this,"health");i(this,"score");i(this,"color");i(this,"movementPattern");i(this,"movementTimer",0);i(this,"game");i(this,"animationPhase",0);i(this,"subEntities",[]);if(this.type=t,this.speed=n.speed,this.health=n.health,this.score=n.score,this.color=n.color,this.movementPattern=this.getMovementPatternForType(),this.game=r,t==="MEDIUM"){const l=3+Math.floor(Math.random()*3);for(let u=0;u<l;u++)this.subEntities.push({x:(Math.random()-.5)*this.width*.8,y:(Math.random()-.5)*this.height*.8,radius:this.width*(.1+Math.random()*.1)})}}getMovementPatternForType(){switch(this.type){case"SMALL":return"zigzag";case"MEDIUM":return"sine";case"LARGE":return"straight";default:return"straight"}}update(t){const s=1+this.game.getDifficultyFactor();switch(this.y+=this.speed*s*t,this.movementTimer+=3*t,this.movementPattern){case"zigzag":this.x+=Math.sin(this.movementTimer*2)*2;break;case"sine":this.x+=Math.sin(this.movementTimer)*1.5;break}(this.x<0||this.x+this.width>h.CANVAS.WIDTH)&&(this.movementPattern="straight"),this.animationPhase+=t*2,this.type==="MEDIUM"&&this.subEntities.forEach(a=>{a.x+=Math.sin(this.animationPhase+a.y)*.5,a.y+=Math.cos(this.animationPhase+a.x)*.5})}draw(t){switch(t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),this.type){case"SMALL":this.drawSmallUMA(t);break;case"MEDIUM":this.drawMediumUMA(t);break;case"LARGE":this.drawLargeUMA(t);break}t.restore()}drawSmallUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<12;a++){const r=a/12*Math.PI*2,n=s*(.8+Math.sin(this.animationPhase+a)*.2);t.lineTo(Math.cos(r)*n,Math.sin(r)*n)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.beginPath(),t.arc(0,0,s*.3,0,Math.PI*2),t.fill(),t.strokeStyle=this.color,t.lineWidth=2;for(let a=0;a<5;a++){const r=a/5*Math.PI*2+this.animationPhase;t.beginPath(),t.moveTo(Math.cos(r)*s*.8,Math.sin(r)*s*.8),t.lineTo(Math.cos(r)*s*1.2,Math.sin(r)*s*1.2),t.stroke()}}drawMediumUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,s,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=2;for(let a=0;a<8;a++){const r=a/8*Math.PI*2,n=s*(1+Math.sin(this.animationPhase+a)*.2);t.beginPath(),t.moveTo(Math.cos(r)*s,Math.sin(r)*s),t.lineTo(Math.cos(r)*n,Math.sin(r)*n),t.stroke()}this.subEntities.forEach(a=>{t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(a.x,a.y,a.radius,0,Math.PI*2),t.fill()})}drawLargeUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath();for(let a=0;a<6;a++){const r=a/6*Math.PI*2,n=s*(1+Math.cos(this.animationPhase+a)*.1);t.lineTo(Math.cos(r)*n,Math.sin(r)*n)}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=3;for(let a=0;a<6;a++){const r=a/6*Math.PI*2,n=s*(1.2+Math.sin(this.animationPhase+a)*.3);t.beginPath(),t.moveTo(Math.cos(r)*s,Math.sin(r)*s),t.lineTo(Math.cos(r)*n,Math.sin(r)*n),t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(0,0,s*.3,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2;for(let a=0;a<3;a++)t.beginPath(),t.arc(0,0,s*(.5+a*.2),0,Math.PI*2),t.stroke()}takeDamage(){return this.health--,this.health<=0}getScore(){return this.score}isOnScreen(){return this.y<h.CANVAS.HEIGHT}getPosition(){return{x:this.x,y:this.y}}getType(){return this.type}}class M extends c{constructor(t,s){super(t,s,h.POWERUP.WIDTH,h.POWERUP.HEIGHT);i(this,"type");i(this,"color");i(this,"rotation",0);i(this,"rotationSpeed");this.type=this.getRandomPowerUpType(),this.color=h.POWERUP.TYPES[this.type].color,this.rotationSpeed=Math.random()*.1+.05}getRandomPowerUpType(){const t=Object.keys(h.POWERUP.TYPES);return t[Math.floor(Math.random()*t.length)]}update(t){this.y+=h.POWERUP.SPEED*t,this.rotation+=this.rotationSpeed*t}draw(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation),t.beginPath(),t.arc(0,0,this.width/2,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),t.beginPath(),t.arc(0,0,this.width/3,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle";let s;switch(this.type){case"RAPID_FIRE":s="R";break;case"TRIPLE_SHOT":s="T";break;case"SHIELD":s="S";break}t.fillText(s,0,0),t.restore()}isOnScreen(){return this.y<h.CANVAS.HEIGHT}getType(){return this.type}}function m(o,e){return Math.random()*(e-o)+o}class E{static createEnemy(e,t){const s=h.ENEMY.TYPES[e],a=m(0,h.CANVAS.WIDTH-s.width);return new T(e,a,-s.height,t)}static createPowerUp(){const e=m(0,h.CANVAS.WIDTH-h.POWERUP.WIDTH);return new M(e,-h.POWERUP.HEIGHT)}}class g{constructor(){i(this,"observers",[]);i(this,"score",0)}attach(e){this.observers.includes(e)||this.observers.push(e)}detach(e){const t=this.observers.indexOf(e);t!==-1&&this.observers.splice(t,1)}notify(){for(const e of this.observers)e.update(this)}getScore(){return this.score}addScore(e){this.score+=e,this.notify()}}class w{constructor(){i(this,"scoreElement");i(this,"levelElement");i(this,"healthElement");i(this,"healthBarElement");this.scoreElement=document.getElementById("scoreValue"),this.levelElement=document.getElementById("levelValue"),this.healthElement=document.getElementById("healthValue"),this.healthBarElement=document.getElementById("healthBarFill")}update(e){e instanceof g&&this.updateScoreDisplay(e.getScore())}updateScoreDisplay(e){this.scoreElement&&(this.scoreElement.textContent=e.toString())}updateLevelDisplay(e){this.levelElement&&(this.levelElement.textContent=e.toString())}updateHealthDisplay(e){if(this.healthElement&&(this.healthElement.textContent=e.toString()),this.healthBarElement){const t=e/h.PLAYER.MAX_HEALTH*100;this.healthBarElement.style.width=`${t}%`}}}class I{constructor(){i(this,"curves");i(this,"colors");this.curves=Array(5).fill(null).map(()=>({offset:Math.random()*Math.PI*2,amplitude:Math.random()*40+20,speed:(Math.random()+.5)*5e-4})),this.colors=["rgba(0, 255, 100, 0.1)","rgba(0, 200, 255, 0.1)","rgba(100, 0, 255, 0.1)","rgba(255, 100, 200, 0.1)","rgba(255, 200, 0, 0.1)"]}update(e){this.curves.forEach(t=>{t.offset+=t.speed*e})}draw(e){e.save(),e.globalCompositeOperation="screen",this.curves.forEach((t,s)=>{const a=e.createLinearGradient(0,0,h.CANVAS.WIDTH,0);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(.5,this.colors[s]),a.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=a;const r=Math.sin(t.offset)*t.amplitude+h.CANVAS.HEIGHT/3;e.beginPath(),e.moveTo(0,r);for(let n=0;n<=h.CANVAS.WIDTH;n+=5){const l=n/h.CANVAS.WIDTH,u=Math.sin(t.offset+l*Math.PI*4)*t.amplitude;e.lineTo(n,r+u)}e.lineTo(h.CANVAS.WIDTH,h.CANVAS.HEIGHT),e.lineTo(0,h.CANVAS.HEIGHT),e.closePath(),e.fill()}),e.restore()}}class b extends c{constructor(t,s,a,r){super(t,s,h.BULLET.WIDTH,h.BULLET.HEIGHT);i(this,"speedX");i(this,"speedY");this.speedX=a,this.speedY=r}update(t){this.x+=this.speedX*t,this.y+=this.speedY*t}draw(t){t.fillStyle="#ff00ff",t.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y<h.CANVAS.HEIGHT&&this.y>0&&this.x<h.CANVAS.WIDTH&&this.x>0}}class H extends c{constructor(t){super(h.CANVAS.WIDTH/2-h.BOSS.WIDTH/2,-h.BOSS.HEIGHT,h.BOSS.WIDTH,h.BOSS.HEIGHT);i(this,"health");i(this,"moveDirection",1);i(this,"lastFireTime",0);i(this,"game");this.health=t.getCurrentBossHealth(),this.game=t}update(t){if(this.y<50)this.y+=h.BOSS.INITIAL_SPEED*t;else{const a=this.x+this.moveDirection*h.BOSS.MOVEMENT_SPEED*t;a<=0?(this.x=0,this.moveDirection=1):a+this.width>=h.CANVAS.WIDTH?(this.x=h.CANVAS.WIDTH-this.width,this.moveDirection=-1):this.x=a}const s=Date.now();s-this.lastFireTime>h.BOSS.FIRE_RATE&&(this.shoot(),this.lastFireTime=s)}shoot(){const t=Math.PI/8;for(let s=-1;s<=1;s++){const a=s*t,r=Math.sin(a)*h.BOSS.BULLET_SPEED,n=Math.cos(a)*h.BOSS.BULLET_SPEED;this.game.addBossBullet(new b(this.x+this.width/2,this.y+this.height,r,n))}}draw(t){t.fillStyle="#ff0000",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.fill();const s=this.health/h.BOSS.INITIAL_HEALTH;t.fillStyle="#00ff00",t.fillRect(this.x,this.y-20,this.width*s,10),t.strokeStyle="#ffffff",t.strokeRect(this.x,this.y-20,this.width,10)}takeDamage(){return this.health--,this.health<=0}getPosition(){return{x:this.x,y:this.y}}}class y{constructor({x:e,y:t},s=1){i(this,"x");i(this,"y");i(this,"particles");i(this,"duration");i(this,"currentFrame");i(this,"maxRadius");this.maxRadius=30*s,this.x=e,this.y=t,this.particles=[],this.duration=h.EXPLOSION.DURATION,this.currentFrame=0;const a=Math.floor(50*s);for(let r=0;r<a;r++){const n=Math.random()*Math.PI*2,l=Math.random()*this.maxRadius;this.particles.push({x:this.x+Math.cos(n)*l*Math.random(),y:this.y+Math.sin(n)*l*Math.random(),radius:Math.random()*4+1,speed:Math.random()*100+25,angle:n,color:this.getExplosionColor()})}}getExplosionColor(){const e=Math.random()*60+10,t=100,s=50+Math.random()*30;return`hsl(${e}, ${t}%, ${s}%)`}update(e){this.currentFrame++;const t=this.currentFrame/this.duration;this.particles.forEach(s=>{const a=t<.2?1:1-(t-.2)/.8;s.x+=Math.cos(s.angle)*s.speed*e*a,s.y+=Math.sin(s.angle)*s.speed*e*a,s.radius*=.98,s.speed*=.98})}draw(e){const t=this.currentFrame/this.duration;this.particles.forEach(s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,0,Math.PI*2),e.fillStyle=s.color,e.globalAlpha=Math.max(0,1-t**1.5),e.fill(),e.beginPath(),e.arc(s.x,s.y,s.radius*1.2,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill()}),e.globalAlpha=1}isFinished(){return this.currentFrame>=this.duration}}class v{constructor(){i(this,"x");i(this,"y");i(this,"width");i(this,"height");i(this,"color");i(this,"particles");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.width=Math.random()*200+100,this.height=Math.random()*200+100,this.color=`hsla(${Math.random()*360}, 70%, 50%, 0.2)`,this.particles=this.generateParticles()}generateParticles(){return Array(50).fill(null).map(()=>({x:(Math.random()-.5)*this.width,y:(Math.random()-.5)*this.height,radius:Math.random()*3+1,alpha:Math.random()*.5+.2}))}draw(e){e.save(),e.translate(this.x,this.y),e.fillStyle=this.color,e.beginPath(),e.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),e.fill(),e.fillStyle=this.color.replace("0.2","1"),this.particles.forEach(t=>{e.globalAlpha=t.alpha,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class D{constructor(){i(this,"x");i(this,"y");i(this,"radius");i(this,"baseColor");i(this,"craters");i(this,"rotation");i(this,"rotationSpeed");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.radius=Math.random()*30+20,this.baseColor=`hsl(${Math.random()*360}, 50%, 50%)`,this.craters=this.generateCraters(),this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01}generateCraters(){const e=Math.floor(Math.random()*5)+3;return Array(e).fill(null).map(()=>({x:(Math.random()-.5)*this.radius*1.5,y:(Math.random()-.5)*this.radius*1.5,radius:Math.random()*(this.radius*.3)+this.radius*.1}))}update(e){this.rotation+=this.rotationSpeed*e}draw(e){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle=this.baseColor,e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.2)",this.craters.forEach(t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class f extends c{constructor(e,t){super(e,t,h.BULLET.WIDTH,h.BULLET.HEIGHT)}update(e){this.y-=h.BULLET.SPEED*e}draw(e){e.fillStyle="#ff0000",e.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y+this.height>0}}class p extends c{constructor(t){super(h.CANVAS.WIDTH/2-h.PLAYER.WIDTH/2,h.CANVAS.HEIGHT-h.PLAYER.HEIGHT-10,h.PLAYER.WIDTH,h.PLAYER.HEIGHT);i(this,"velocity",{x:0,y:0});i(this,"health");i(this,"fireRate");i(this,"bulletType","single");i(this,"shieldActive",!1);i(this,"activePowerups",[]);i(this,"keys",{});i(this,"engineAnimationPhase",0);i(this,"invincible",!1);i(this,"lastHitTime",0);i(this,"lastFireTime",0);this.game=t,this.health=h.PLAYER.MAX_HEALTH,this.fireRate=h.PLAYER.FIRE_RATE}setKeyState(t,s){this.keys[t]=s}update(t){this.keys.ArrowLeft&&(this.velocity.x-=h.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=h.PLAYER.ACCELERATION),this.keys[" "]&&this.shoot(),this.move(t),this.updateInvincibility(),this.updateEngineAnimation(t)}move(t){if(this.keys.ArrowLeft&&(this.velocity.x-=h.PLAYER.ACCELERATION),this.keys.ArrowRight&&(this.velocity.x+=h.PLAYER.ACCELERATION),this.velocity.x=Math.max(Math.min(this.velocity.x,h.PLAYER.MAX_SPEED),-h.PLAYER.MAX_SPEED),this.x+=this.velocity.x*t,this.x<0?(this.x=0,this.velocity.x=0):this.x+this.width>h.CANVAS.WIDTH&&(this.x=h.CANVAS.WIDTH-this.width,this.velocity.x=0),Math.abs(this.velocity.x)>0){const s=Math.sign(this.velocity.x)*-h.PLAYER.DECELERATION;this.velocity.x+=s,Math.abs(this.velocity.x)<h.PLAYER.DECELERATION&&(this.velocity.x=0)}}shoot(){const t=Date.now();t-this.lastFireTime>=this.fireRate&&(this.bulletType==="single"?this.game.addBullet(new f(this.x+this.width/2-h.BULLET.WIDTH/2,this.y)):this.bulletType==="triple"&&(this.game.addBullet(new f(this.x+this.width/2-h.BULLET.WIDTH/2,this.y)),this.game.addBullet(new f(this.x+this.width/2-h.BULLET.WIDTH/2-20,this.y+10)),this.game.addBullet(new f(this.x+this.width/2-h.BULLET.WIDTH/2+20,this.y+10))),this.lastFireTime=t)}takeDamage(t){!this.invincible&&!this.shieldActive&&(this.health=Math.max(0,this.health-t),this.invincible=!0,this.lastHitTime=Date.now(),this.health<=0&&this.game.gameOver())}updateInvincibility(){this.invincible&&Date.now()-this.lastHitTime>h.PLAYER.INVINCIBILITY_TIME&&(this.invincible=!1)}updateEngineAnimation(t){this.engineAnimationPhase+=h.PLAYER.ACCELERATION*t,this.engineAnimationPhase>Math.PI*2&&(this.engineAnimationPhase=0)}draw(t){t.fillStyle=this.invincible?"rgba(255, 0, 0, 0.5)":"#00ff00",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#0099ff",t.beginPath(),t.moveTo(this.x,this.y+this.height*.7),t.lineTo(this.x-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width*.3,this.y+this.height),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.x+this.width,this.y+this.height*.7),t.lineTo(this.x+this.width-this.width*.3,this.y+this.height),t.lineTo(this.x+this.width+this.width*.3,this.y+this.height),t.closePath(),t.fill();const s=5+Math.sin(this.engineAnimationPhase)*2,a=t.createRadialGradient(this.x+this.width/2,this.y+this.height,0,this.x+this.width/2,this.y+this.height,s);a.addColorStop(0,"rgba(255, 255, 0, 1)"),a.addColorStop(1,"rgba(255, 100, 0, 0)"),t.fillStyle=a,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height,s,0,Math.PI*2),t.fill(),this.shieldActive&&(t.strokeStyle="rgba(0, 255, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2),t.stroke())}activatePowerup(t){h.POWERUP.TYPES[t].effect(this),this.activePowerups.push({type:t,startTime:Date.now()}),setTimeout(()=>this.deactivatePowerup(t),h.POWERUP.DURATION)}deactivatePowerup(t){switch(this.activePowerups=this.activePowerups.filter(s=>s.type!==t),t){case"RAPID_FIRE":this.fireRate=h.PLAYER.FIRE_RATE;break;case"TRIPLE_SHOT":this.bulletType="single";break;case"SHIELD":this.shieldActive=!1;break}}getHealth(){return this.health}setFireRate(t){this.fireRate=t}setBulletType(t){this.bulletType=t}activateShield(){this.shieldActive=!0}getPosition(){return{x:this.x,y:this.y}}}class L{constructor(){i(this,"x");i(this,"y");i(this,"size");i(this,"speed");i(this,"twinkleSpeed");i(this,"twinkleOffset");this.x=Math.random()*h.CANVAS.WIDTH,this.y=Math.random()*h.CANVAS.HEIGHT,this.size=Math.random()*2+1,this.speed=Math.random()*10+5,this.twinkleSpeed=Math.random()*.05+.01,this.twinkleOffset=Math.random()*Math.PI*2}update(e){this.y+=this.speed*e,this.y>h.CANVAS.HEIGHT&&(this.y=0,this.x=Math.random()*h.CANVAS.WIDTH),this.twinkleOffset+=this.twinkleSpeed}draw(e){const t=Math.sin(this.twinkleOffset)*.5+.5;e.fillStyle=`rgba(255, 255, 255, ${.5+t*.5})`,e.beginPath(),e.arc(this.x,this.y,this.size*(.8+t*.2),0,Math.PI*2),e.fill()}}class C{constructor(){i(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(s=>s!==t))}emit(e,...t){this.events[e]&&this.events[e].forEach(s=>s(...t))}}class R{constructor(){i(this,"currentState",0)}setState(e){this.currentState=e}getState(){return this.currentState}isPlaying(){return this.currentState===1}}var d=(o=>(o[o.STARTING=0]="STARTING",o[o.PLAYING=1]="PLAYING",o[o.PAUSED=2]="PAUSED",o[o.GAME_OVER=3]="GAME_OVER",o))(d||{});class O extends C{constructor(){super();i(this,"canvas");i(this,"ctx");i(this,"player");i(this,"bullets",[]);i(this,"enemies",[]);i(this,"stars",[]);i(this,"explosions",[]);i(this,"planets",[]);i(this,"nebulas",[]);i(this,"auroras",[]);i(this,"powerups",[]);i(this,"boss",null);i(this,"bossBullets",[]);i(this,"level",1);i(this,"bossSpawnScore",1e3);i(this,"currentScore",0);i(this,"lastTime",0);i(this,"deltaTime",0);i(this,"stateManager",new R);i(this,"scoreManager",new g);i(this,"uiManager",new w);i(this,"difficultyFactor",0);i(this,"currentBossHealth",h.BOSS.INITIAL_HEALTH);i(this,"handleKeyDown",t=>{this.player.setKeyState(t.key,!0)});i(this,"handleKeyUp",t=>{this.player.setKeyState(t.key,!1)});i(this,"handleEnemyDestroyed",t=>{const s=t.getPosition(),a={x:s.x+t.getWidth()/2,y:s.y+t.getHeight()/2};this.explosions.push(new y(a)),this.scoreManager.addScore(t.getScore())});i(this,"handlePlayerDamaged",t=>{this.player.takeDamage(t),this.player.getHealth()<=0&&this.gameOver()});i(this,"handleBossDamaged",()=>{this.boss&&this.boss.takeDamage()&&this.emit("bossDefeated")});i(this,"handleBossDefeated",()=>{this.boss&&(this.explosions.push(new y(this.boss.getPosition())),this.boss=null,this.handleBossDefeat())});i(this,"handlePowerUpCollected",t=>{this.player.activatePowerup(t.getType())});i(this,"gameLoop",t=>{this.deltaTime=(t-this.lastTime)/1e3,this.lastTime=t,this.stateManager.isPlaying()&&(this.update(),this.draw()),requestAnimationFrame(this.gameLoop)});i(this,"spawnEnemy",()=>{if(this.stateManager.isPlaying()&&!this.boss){const t=Object.keys(h.ENEMY.TYPES),s=t[Math.floor(Math.random()*t.length)];this.enemies.push(E.createEnemy(s,this)),Math.random()<h.POWERUP.SPAWN_CHANCE&&this.powerups.push(E.createPowerUp())}});i(this,"restartGame",()=>{const t=document.getElementById("gameOver");t&&t.classList.add("hidden"),this.resetGame(),this.start()});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=h.CANVAS.WIDTH,this.canvas.height=h.CANVAS.HEIGHT,this.player=new p(this),this.initializeGameObjects(),this.setupEventListeners(),this.scoreManager.attach(this.uiManager),this.stateManager.setState(d.PLAYING)}initializeGameObjects(){this.stars=Array.from({length:h.BACKGROUND.STAR_COUNT},()=>new L),this.planets=Array.from({length:h.BACKGROUND.PLANET_COUNT},()=>new D),this.nebulas=Array.from({length:h.BACKGROUND.NEBULA_COUNT},()=>new v),this.auroras=Array.from({length:2},()=>new I)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp);const t=document.getElementById("restartButton");t&&t.addEventListener("click",this.restartGame),this.on("enemyDestroyed",this.handleEnemyDestroyed),this.on("playerDamaged",this.handlePlayerDamaged),this.on("bossDamaged",this.handleBossDamaged),this.on("bossDefeated",this.handleBossDefeated),this.on("powerUpCollected",this.handlePowerUpCollected)}start(){this.gameLoop(0),setInterval(this.spawnEnemy,h.ENEMY.SPAWN_INTERVAL)}update(){this.player.update(this.deltaTime),this.updateGameObjects(),this.checkCollisions(),this.removeOffscreenObjects(),this.uiManager.updateHealthDisplay(this.player.getHealth()),this.uiManager.updateLevelDisplay(this.level)}updateGameObjects(){const t=[...this.bullets,...this.enemies,...this.powerups,...this.explosions,...this.stars,...this.planets,...this.auroras,...this.bossBullets];this.boss&&t.push(this.boss),t.forEach(s=>s.update(this.deltaTime)),this.currentScore=this.scoreManager.getScore(),this.currentScore>=this.bossSpawnScore&&!this.boss&&this.spawnBoss()}spawnBoss(){this.boss=new H(this),this.showMessage("ボスが出現しました！")}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions(),this.checkPlayerPowerupCollisions(),this.boss&&this.checkBossBattleCollisions()}checkBulletEnemyCollisions(){for(let t=this.bullets.length-1;t>=0;t--)for(let s=this.enemies.length-1;s>=0;s--)if(this.checkCollision(this.bullets[t],this.enemies[s])){this.bullets.splice(t,1),this.enemies[s].takeDamage()&&(this.emit("enemyDestroyed",this.enemies[s]),this.enemies.splice(s,1));break}}checkPlayerEnemyCollisions(){for(let t=this.enemies.length-1;t>=0;t--)this.checkCollision(this.player,this.enemies[t])&&(this.emit("playerDamaged",20),this.emit("enemyDestroyed",this.enemies[t]),this.enemies.splice(t,1))}checkPlayerPowerupCollisions(){for(let t=this.powerups.length-1;t>=0;t--)this.checkCollision(this.player,this.powerups[t])&&(this.emit("powerUpCollected",this.powerups[t]),this.powerups.splice(t,1))}checkBossBattleCollisions(){this.boss&&this.checkCollision(this.player,this.boss)&&this.emit("playerDamaged",20);for(let t=this.bullets.length-1;t>=0;t--)this.boss&&this.checkCollision(this.bullets[t],this.boss)&&(this.bullets.splice(t,1),this.emit("bossDamaged"));for(let t=this.bossBullets.length-1;t>=0;t--)this.checkCollision(this.player,this.bossBullets[t])&&(this.emit("playerDamaged",20),this.bossBullets.splice(t,1))}removeOffscreenObjects(){this.bullets=this.bullets.filter(t=>t.isOnScreen()),this.enemies=this.enemies.filter(t=>t.isOnScreen()),this.powerups=this.powerups.filter(t=>t.isOnScreen()),this.explosions=this.explosions.filter(t=>!t.isFinished()),this.bossBullets=this.bossBullets.filter(t=>t.isOnScreen())}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,h.CANVAS.HEIGHT);t.addColorStop(0,"rgba(0, 0, 51, 0.8)"),t.addColorStop(1,"rgba(0, 0, 102, 0.8)"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,h.CANVAS.WIDTH,h.CANVAS.HEIGHT),this.nebulas.forEach(s=>s.draw(this.ctx)),this.planets.forEach(s=>s.draw(this.ctx)),this.stars.forEach(s=>s.draw(this.ctx)),this.auroras.forEach(s=>s.draw(this.ctx)),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(50,50),this.ctx.lineTo(100,100),this.ctx.lineTo(150,75),this.ctx.lineTo(200,150),this.ctx.stroke()}draw(){this.drawBackground(),this.player.draw(this.ctx),this.bullets.forEach(t=>t.draw(this.ctx)),this.enemies.forEach(t=>t.draw(this.ctx)),this.powerups.forEach(t=>t.draw(this.ctx)),this.explosions.forEach(t=>t.draw(this.ctx)),this.boss&&(this.boss.draw(this.ctx),this.bossBullets.forEach(t=>t.draw(this.ctx)))}checkCollision(t,s){return t.getX()<s.getX()+s.getWidth()&&t.getX()+t.getWidth()>s.getX()&&t.getY()<s.getY()+s.getHeight()&&t.getY()+t.getHeight()>s.getY()}gameOver(){this.stateManager.setState(d.GAME_OVER);const t=document.getElementById("gameOver");t&&t.classList.remove("hidden");const s=document.getElementById("finalScore");s&&(s.textContent=this.scoreManager.getScore().toString())}resetGame(){this.player=new p(this),this.bullets=[],this.enemies=[],this.powerups=[],this.explosions=[],this.boss=null,this.bossBullets=[],this.level=1,this.bossSpawnScore=1e3,this.scoreManager=new g,this.scoreManager.attach(this.uiManager),this.stateManager.setState(d.PLAYING)}handleBossDefeat(){this.scoreManager.addScore(500),this.showMessage(`レベル ${this.level} クリア！次のレベルが始まります。`),this.level++,this.uiManager.updateLevelDisplay(this.level),setTimeout(()=>{this.startNextLevel()},3e3),this.bossSpawnScore=this.currentScore+1e3}startNextLevel(){this.enemies=[],this.bossBullets=[],this.powerups=[],this.difficultyFactor=this.level*.1,this.currentBossHealth=h.BOSS.INITIAL_HEALTH+(this.level-1)*10,this.bossSpawnScore=this.scoreManager.getScore()+1e3,this.showMessage(`レベル ${this.level} 開始！`)}showMessage(t){const s=document.createElement("div");s.textContent=t,s.style.position="absolute",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.color="white",s.style.fontSize="24px",s.style.textAlign="center",document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},3e3)}addBullet(t){this.bullets.push(t)}addBossBullet(t){this.bossBullets.push(t)}pauseGame(){this.stateManager.setState(d.PAUSED)}resumeGame(){this.stateManager.setState(d.PLAYING)}getDifficultyFactor(){return this.difficultyFactor}getCurrentBossHealth(){return this.currentBossHealth}}let P;function N(){P=new O,P.start()}document.addEventListener("DOMContentLoaded",N);
