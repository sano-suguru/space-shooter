var P=Object.defineProperty;var w=(o,e,t)=>e in o?P(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>w(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const a={CANVAS:{WIDTH:400,HEIGHT:600},PLAYER:{WIDTH:50,HEIGHT:50,MAX_SPEED:6,ACCELERATION:.8,DECELERATION:.3,MAX_HEALTH:100,INVINCIBILITY_TIME:1e3,FIRE_RATE:200,COLORS:{PRIMARY:"#1a237e",SECONDARY:"#3f51b5",ACCENT:"#00bcd4",ENGINE:"#ff9800"}},BULLET:{WIDTH:5,HEIGHT:15,SPEED:600},ENEMY:{SPAWN_INTERVAL:1e3,TYPES:{SMALL:{width:30,height:30,speed:180,health:1,score:10,color:"#ff00ff"},MEDIUM:{width:50,height:50,speed:120,health:2,score:20,color:"#00ffff"},LARGE:{width:70,height:70,speed:60,health:3,score:30,color:"#ffff00"}}},BOSS:{WIDTH:150,HEIGHT:150,BULLET_SPEED:200,FIRE_RATE:1e3,INITIAL_HEALTH:50,INITIAL_SPEED:50,MOVEMENT_SPEED:50},POWERUP:{WIDTH:30,HEIGHT:30,SPEED:100,DURATION:1e4,SPAWN_CHANCE:.05,TYPES:{RAPID_FIRE:{color:"#00ff00",effect:o=>{o.setFireRate(a.PLAYER.FIRE_RATE/2)}},TRIPLE_SHOT:{color:"#0000ff",effect:o=>{o.setBulletType("triple")}},SHIELD:{color:"#ffff00",effect:o=>{o.activateShield()}}}},EXPLOSION:{DURATION:30},BACKGROUND:{STAR_COUNT:100,PLANET_COUNT:2,NEBULA_COUNT:1}};class T{constructor(){h(this,"curves");h(this,"colors");this.curves=Array(5).fill(null).map(()=>({offset:Math.random()*Math.PI*2,amplitude:Math.random()*40+20,speed:(Math.random()+.5)*5e-4})),this.colors=["rgba(0, 255, 100, 0.1)","rgba(0, 200, 255, 0.1)","rgba(100, 0, 255, 0.1)","rgba(255, 100, 200, 0.1)","rgba(255, 200, 0, 0.1)"]}update(e){this.curves.forEach(t=>{t.offset+=t.speed*e})}draw(e){e.save(),e.globalCompositeOperation="screen",this.curves.forEach((t,s)=>{const i=e.createLinearGradient(0,0,a.CANVAS.WIDTH,0);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(.5,this.colors[s]),i.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=i;const r=Math.sin(t.offset)*t.amplitude+a.CANVAS.HEIGHT/3;e.beginPath(),e.moveTo(0,r);for(let n=0;n<=a.CANVAS.WIDTH;n+=5){const l=n/a.CANVAS.WIDTH,d=Math.sin(t.offset+l*Math.PI*4)*t.amplitude;e.lineTo(n,r+d)}e.lineTo(a.CANVAS.WIDTH,a.CANVAS.HEIGHT),e.lineTo(0,a.CANVAS.HEIGHT),e.closePath(),e.fill()}),e.restore()}}class m{constructor(e,t,s,i){this.x=e,this.y=t,this.width=s,this.height=i}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}}class A extends m{constructor(t,s,i,r){const n=a.ENEMY.TYPES[t];super(s,i,n.width,n.height);h(this,"type");h(this,"speed");h(this,"health");h(this,"score");h(this,"color");h(this,"movementPattern");h(this,"movementTimer",0);h(this,"game");h(this,"animationPhase",0);h(this,"subEntities",[]);if(this.type=t,this.speed=n.speed,this.health=n.health,this.score=n.score,this.color=n.color,this.movementPattern=this.getMovementPatternForType(),this.game=r,t==="MEDIUM"){const l=3+Math.floor(Math.random()*3);for(let d=0;d<l;d++)this.subEntities.push({x:(Math.random()-.5)*this.width*.8,y:(Math.random()-.5)*this.height*.8,radius:this.width*(.1+Math.random()*.1)})}}getMovementPatternForType(){switch(this.type){case"SMALL":return"zigzag";case"MEDIUM":return"sine";case"LARGE":return"straight";default:return"straight"}}update(t){const s=1+this.game.getDifficultyFactor();switch(this.y+=this.speed*s*t,this.movementTimer+=3*t,this.movementPattern){case"zigzag":this.x+=Math.sin(this.movementTimer*2)*2;break;case"sine":this.x+=Math.sin(this.movementTimer)*1.5;break}(this.x<0||this.x+this.width>a.CANVAS.WIDTH)&&(this.movementPattern="straight"),this.animationPhase+=t*2,this.type==="MEDIUM"&&this.subEntities.forEach(i=>{i.x+=Math.sin(this.animationPhase+i.y)*.5,i.y+=Math.cos(this.animationPhase+i.x)*.5})}draw(t){switch(t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),this.type){case"SMALL":this.drawSmallUMA(t);break;case"MEDIUM":this.drawMediumUMA(t);break;case"LARGE":this.drawLargeUMA(t);break}t.restore()}drawSmallUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath();for(let i=0;i<12;i++){const r=i/12*Math.PI*2,n=s*(.8+Math.sin(this.animationPhase+i)*.2);t.lineTo(Math.cos(r)*n,Math.sin(r)*n)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.beginPath(),t.arc(0,0,s*.3,0,Math.PI*2),t.fill(),t.strokeStyle=this.color,t.lineWidth=2;for(let i=0;i<5;i++){const r=i/5*Math.PI*2+this.animationPhase;t.beginPath(),t.moveTo(Math.cos(r)*s*.8,Math.sin(r)*s*.8),t.lineTo(Math.cos(r)*s*1.2,Math.sin(r)*s*1.2),t.stroke()}}drawMediumUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,s,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=2;for(let i=0;i<8;i++){const r=i/8*Math.PI*2,n=s*(1+Math.sin(this.animationPhase+i)*.2);t.beginPath(),t.moveTo(Math.cos(r)*s,Math.sin(r)*s),t.lineTo(Math.cos(r)*n,Math.sin(r)*n),t.stroke()}this.subEntities.forEach(i=>{t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(i.x,i.y,i.radius,0,Math.PI*2),t.fill()})}drawLargeUMA(t){const s=this.width/2;t.fillStyle=this.color,t.beginPath();for(let i=0;i<6;i++){const r=i/6*Math.PI*2,n=s*(1+Math.cos(this.animationPhase+i)*.1);t.lineTo(Math.cos(r)*n,Math.sin(r)*n)}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=3;for(let i=0;i<6;i++){const r=i/6*Math.PI*2,n=s*(1.2+Math.sin(this.animationPhase+i)*.3);t.beginPath(),t.moveTo(Math.cos(r)*s,Math.sin(r)*s),t.lineTo(Math.cos(r)*n,Math.sin(r)*n),t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(0,0,s*.3,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2;for(let i=0;i<3;i++)t.beginPath(),t.arc(0,0,s*(.5+i*.2),0,Math.PI*2),t.stroke()}takeDamage(){return this.health--,this.health<=0}getScore(){return this.score}isOnScreen(){return this.y<a.CANVAS.HEIGHT}getPosition(){return{x:this.x,y:this.y}}getType(){return this.type}}class M{constructor(){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"color");h(this,"particles");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.width=Math.random()*200+100,this.height=Math.random()*200+100,this.color=`hsla(${Math.random()*360}, 70%, 50%, 0.2)`,this.particles=this.generateParticles()}generateParticles(){return Array(50).fill(null).map(()=>({x:(Math.random()-.5)*this.width,y:(Math.random()-.5)*this.height,radius:Math.random()*3+1,alpha:Math.random()*.5+.2}))}draw(e){e.save(),e.translate(this.x,this.y),e.fillStyle=this.color,e.beginPath(),e.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),e.fill(),e.fillStyle=this.color.replace("0.2","1"),this.particles.forEach(t=>{e.globalAlpha=t.alpha,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class I{constructor(){h(this,"x");h(this,"y");h(this,"radius");h(this,"baseColor");h(this,"craters");h(this,"rotation");h(this,"rotationSpeed");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.radius=Math.random()*30+20,this.baseColor=`hsl(${Math.random()*360}, 50%, 50%)`,this.craters=this.generateCraters(),this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01}generateCraters(){const e=Math.floor(Math.random()*5)+3;return Array(e).fill(null).map(()=>({x:(Math.random()-.5)*this.radius*1.5,y:(Math.random()-.5)*this.radius*1.5,radius:Math.random()*(this.radius*.3)+this.radius*.1}))}update(e){this.rotation+=this.rotationSpeed*e}draw(e){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle=this.baseColor,e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.2)",this.craters.forEach(t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fill()}),e.restore()}}class v extends m{constructor(t,s){super(t,s,a.POWERUP.WIDTH,a.POWERUP.HEIGHT);h(this,"type");h(this,"color");h(this,"rotation",0);h(this,"rotationSpeed");h(this,"glowIntensity",0);h(this,"glowDirection",1);h(this,"trail",[]);h(this,"trailUpdateCounter",0);this.type=this.getRandomPowerUpType(),this.color=a.POWERUP.TYPES[this.type].color,this.rotationSpeed=Math.random()*.1+.05}getRandomPowerUpType(){const t=Object.keys(a.POWERUP.TYPES);return t[Math.floor(Math.random()*t.length)]}update(t){this.y+=a.POWERUP.SPEED*t,this.rotation+=this.rotationSpeed*t,this.glowIntensity+=.05*this.glowDirection,(this.glowIntensity>=1||this.glowIntensity<=0)&&(this.glowDirection*=-1),this.trailUpdateCounter+=t,this.trailUpdateCounter>=.05&&(this.trail.unshift({x:this.x,y:this.y,alpha:1}),this.trailUpdateCounter=0),this.trail.length>30&&this.trail.pop(),this.trail.forEach(s=>s.alpha-=.02)}draw(t){this.drawTrail(t),t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation);const s=this.width/2+5+this.glowIntensity*3,i=t.createRadialGradient(0,0,this.width/2,0,0,s);i.addColorStop(0,this.color),i.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=i,t.beginPath(),t.arc(0,0,s,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(0,0,this.width/2,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),t.beginPath(),t.arc(0,0,this.width/3,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle";let r;switch(this.type){case"RAPID_FIRE":r="R";break;case"TRIPLE_SHOT":r="T";break;case"SHIELD":r="S";break}t.fillText(r,0,0),t.restore()}drawTrail(t){t.save();for(let s=this.trail.length-1;s>=0;s--){const i=this.trail[s],r=this.width/2*(1-s/this.trail.length)*.8;t.fillStyle=`rgba(${parseInt(this.color.slice(1,3),16)}, ${parseInt(this.color.slice(3,5),16)}, ${parseInt(this.color.slice(5,7),16)}, ${i.alpha*.8})`,t.beginPath(),t.arc(i.x+this.width/2,i.y+this.height/2,r,0,Math.PI*2),t.fill()}t.restore()}isOnScreen(){return this.y<a.CANVAS.HEIGHT}getType(){return this.type}}class b{constructor(){h(this,"x");h(this,"y");h(this,"size");h(this,"speed");h(this,"twinkleSpeed");h(this,"twinkleOffset");this.x=Math.random()*a.CANVAS.WIDTH,this.y=Math.random()*a.CANVAS.HEIGHT,this.size=Math.random()*2+1,this.speed=Math.random()*10+5,this.twinkleSpeed=Math.random()*.05+.01,this.twinkleOffset=Math.random()*Math.PI*2}update(e){this.y+=this.speed*e,this.y>a.CANVAS.HEIGHT&&(this.y=0,this.x=Math.random()*a.CANVAS.WIDTH),this.twinkleOffset+=this.twinkleSpeed}draw(e){const t=Math.sin(this.twinkleOffset)*.5+.5;e.fillStyle=`rgba(255, 255, 255, ${.5+t*.5})`,e.beginPath(),e.arc(this.x,this.y,this.size*(.8+t*.2),0,Math.PI*2),e.fill()}}function u(o,e){return Math.random()*(e-o)+o}class C{createStar(){return new b}createPlanet(){return new I}createNebula(){return new M}createAurora(){return new T}createEnemy(e,t){const s=a.ENEMY.TYPES[e],i=u(0,a.CANVAS.WIDTH-s.width);return new A(e,i,-s.height,t)}createPowerUp(){const e=u(0,a.CANVAS.WIDTH-a.POWERUP.WIDTH);return new v(e,-a.POWERUP.HEIGHT)}}class D extends m{constructor(t,s,i,r){super(t,s,a.BULLET.WIDTH,a.BULLET.HEIGHT);h(this,"speedX");h(this,"speedY");this.speedX=i,this.speedY=r}update(t){this.x+=this.speedX*t,this.y+=this.speedY*t}draw(t){t.fillStyle="#ff00ff",t.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y<a.CANVAS.HEIGHT&&this.y>0&&this.x<a.CANVAS.WIDTH&&this.x>0}}class H extends m{constructor(t){super(a.CANVAS.WIDTH/2-a.BOSS.WIDTH/2,-a.BOSS.HEIGHT,a.BOSS.WIDTH,a.BOSS.HEIGHT);h(this,"health");h(this,"moveDirection",1);h(this,"lastFireTime",0);h(this,"game");this.health=t.getCurrentBossHealth(),this.game=t}update(t){if(this.y<50)this.y+=a.BOSS.INITIAL_SPEED*t;else{const i=this.x+this.moveDirection*a.BOSS.MOVEMENT_SPEED*t;i<=0?(this.x=0,this.moveDirection=1):i+this.width>=a.CANVAS.WIDTH?(this.x=a.CANVAS.WIDTH-this.width,this.moveDirection=-1):this.x=i}const s=Date.now();s-this.lastFireTime>a.BOSS.FIRE_RATE&&(this.shoot(),this.lastFireTime=s)}shoot(){const t=Math.PI/8;for(let s=-1;s<=1;s++){const i=s*t,r=Math.sin(i)*a.BOSS.BULLET_SPEED,n=Math.cos(i)*a.BOSS.BULLET_SPEED;this.game.addBossBullet(new D(this.x+this.width/2,this.y+this.height,r,n))}}draw(t){t.fillStyle="#ff0000",t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.1,0,Math.PI*2),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+this.width*.3,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.arc(this.x+this.width*.7,this.y+this.height*.3,this.width*.05,0,Math.PI*2),t.fill();const s=this.health/a.BOSS.INITIAL_HEALTH;t.fillStyle="#00ff00",t.fillRect(this.x,this.y-20,this.width*s,10),t.strokeStyle="#ffffff",t.strokeRect(this.x,this.y-20,this.width,10)}takeDamage(){return this.health--,this.health<=0}getPosition(){return{x:this.x,y:this.y}}}class p{constructor({x:e,y:t},s=1){h(this,"x");h(this,"y");h(this,"particles");h(this,"duration");h(this,"currentFrame");h(this,"maxRadius");this.maxRadius=30*s,this.x=e,this.y=t,this.particles=[],this.duration=a.EXPLOSION.DURATION,this.currentFrame=0;const i=Math.floor(50*s);for(let r=0;r<i;r++){const n=Math.random()*Math.PI*2,l=Math.random()*this.maxRadius;this.particles.push({x:this.x+Math.cos(n)*l*Math.random(),y:this.y+Math.sin(n)*l*Math.random(),radius:Math.random()*4+1,speed:Math.random()*100+25,angle:n,color:this.getExplosionColor()})}}getExplosionColor(){const e=Math.random()*60+10,t=100,s=50+Math.random()*30;return`hsl(${e}, ${t}%, ${s}%)`}update(e){this.currentFrame++;const t=this.currentFrame/this.duration;this.particles.forEach(s=>{const i=t<.2?1:1-(t-.2)/.8;s.x+=Math.cos(s.angle)*s.speed*e*i,s.y+=Math.sin(s.angle)*s.speed*e*i,s.radius*=.98,s.speed*=.98})}draw(e){const t=this.currentFrame/this.duration;this.particles.forEach(s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,0,Math.PI*2),e.fillStyle=s.color,e.globalAlpha=Math.max(0,1-t**1.5),e.fill(),e.beginPath(),e.arc(s.x,s.y,s.radius*1.2,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill()}),e.globalAlpha=1}isFinished(){return this.currentFrame>=this.duration}}class g extends m{constructor(e,t){super(e,t,a.BULLET.WIDTH,a.BULLET.HEIGHT)}update(e){this.y-=a.BULLET.SPEED*e}draw(e){e.fillStyle="#ff0000",e.fillRect(this.x,this.y,this.width,this.height)}isOnScreen(){return this.y+this.height>0}}class E extends m{constructor(t){super(a.CANVAS.WIDTH/2-a.PLAYER.WIDTH/2,a.CANVAS.HEIGHT-a.PLAYER.HEIGHT-10,a.PLAYER.WIDTH,a.PLAYER.HEIGHT);h(this,"velocity",{x:0,y:0});h(this,"health");h(this,"fireRate");h(this,"bulletType","single");h(this,"shieldActive",!1);h(this,"activePowerups",[]);h(this,"keys",{});h(this,"engineAnimationPhase",0);h(this,"invincible",!1);h(this,"lastHitTime",0);h(this,"lastFireTime",0);h(this,"thrusterParticles",[]);this.eventEmitter=t,this.health=a.PLAYER.MAX_HEALTH,this.fireRate=a.PLAYER.FIRE_RATE}setKeyState(t,s){this.keys[t]=s}update(t){this.updateMovement(),this.updateShooting(),this.updateInvincibility(),this.updateEngineAnimation(t),this.updateThrusterParticles(t)}updateMovement(){const{CANVAS:t}=a;this.updateVelocity(),this.x+=this.velocity.x,this.clampPosition(0,t.WIDTH-this.width),this.generateThrusterParticles()}updateVelocity(){const{ACCELERATION:t,MAX_SPEED:s}=a.PLAYER;this.keys.ArrowLeft?this.velocity.x=Math.max(this.velocity.x-t,-s):this.keys.ArrowRight?this.velocity.x=Math.min(this.velocity.x+t,s):this.applyDeceleration()}applyDeceleration(){const{DECELERATION:t}=a.PLAYER;this.velocity.x>0?this.velocity.x=Math.max(0,this.velocity.x-t):this.velocity.x<0&&(this.velocity.x=Math.min(0,this.velocity.x+t))}clampPosition(t,s){this.x<t?(this.x=t,this.velocity.x=0):this.x>s&&(this.x=s,this.velocity.x=0)}updateShooting(){this.keys[" "]&&this.shoot()}shoot(){const t=Date.now();t-this.lastFireTime>=this.fireRate&&(this.bulletType==="single"?this.eventEmitter.emit("playerShot",new g(this.x+this.width/2-a.BULLET.WIDTH/2,this.y)):this.bulletType==="triple"&&(this.eventEmitter.emit("playerShot",new g(this.x+this.width/2-a.BULLET.WIDTH/2,this.y)),this.eventEmitter.emit("playerShot",new g(this.x+this.width/2-a.BULLET.WIDTH/2-20,this.y+10)),this.eventEmitter.emit("playerShot",new g(this.x+this.width/2-a.BULLET.WIDTH/2+20,this.y+10))),this.lastFireTime=t)}updateInvincibility(){this.invincible&&Date.now()-this.lastHitTime>a.PLAYER.INVINCIBILITY_TIME&&(this.invincible=!1)}updateEngineAnimation(t){this.engineAnimationPhase+=10*t,this.engineAnimationPhase>Math.PI*2&&(this.engineAnimationPhase=0)}generateThrusterParticles(){for(let s=0;s<3;s++)this.thrusterParticles.push({x:this.x+this.width/2,y:this.y+this.height,speed:Math.random()*50+50,life:1})}updateThrusterParticles(t){for(let s=this.thrusterParticles.length-1;s>=0;s--){const i=this.thrusterParticles[s];i.y+=i.speed*t,i.life-=t,i.life<=0&&this.thrusterParticles.splice(s,1)}}draw(t){this.drawThrusterParticles(t),this.drawShip(t),this.drawShield(t)}drawShip(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.fillStyle=this.invincible?"rgba(255, 0, 0, 0.5)":a.PLAYER.COLORS.PRIMARY,t.beginPath(),t.moveTo(0,-this.height/2),t.lineTo(-this.width/2,this.height/2),t.lineTo(this.width/2,this.height/2),t.closePath(),t.fill(),t.fillStyle=a.PLAYER.COLORS.SECONDARY,t.beginPath(),t.moveTo(-this.width/4,0),t.lineTo(-this.width/2,this.height/2),t.lineTo(0,this.height/4),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.width/4,0),t.lineTo(this.width/2,this.height/2),t.lineTo(0,this.height/4),t.closePath(),t.fill(),t.fillStyle=a.PLAYER.COLORS.ACCENT,t.beginPath(),t.ellipse(0,-this.height/6,this.width/6,this.height/6,0,0,Math.PI*2),t.fill();const s=10+Math.sin(this.engineAnimationPhase)*3,i=t.createRadialGradient(0,this.height/2,0,0,this.height/2,s);i.addColorStop(0,a.PLAYER.COLORS.ENGINE),i.addColorStop(.5,"rgba(255, 100, 0, 0.5)"),i.addColorStop(1,"rgba(255, 0, 0, 0)"),t.fillStyle=i,t.beginPath(),t.arc(0,this.height/2,s,0,Math.PI*2),t.fill(),t.restore()}drawThrusterParticles(t){t.save();for(const s of this.thrusterParticles){const i=s.life,r=5*s.life;t.fillStyle=`rgba(255, 100, 0, ${i})`,t.beginPath(),t.arc(s.x,s.y,r,0,Math.PI*2),t.fill()}t.restore()}drawShield(t){if(this.shieldActive){t.save(),t.strokeStyle="rgba(0, 255, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2),t.stroke();const s=t.createRadialGradient(this.x+this.width/2,this.y+this.height/2,this.width/2,this.x+this.width/2,this.y+this.height/2,this.width/2+15);s.addColorStop(0,"rgba(0, 255, 255, 0.1)"),s.addColorStop(1,"rgba(0, 255, 255, 0)"),t.fillStyle=s,t.fill(),t.restore()}}takeDamage(t){!this.invincible&&!this.shieldActive&&(this.health=Math.max(0,this.health-t),this.eventEmitter.emit("healthChanged",this.health),this.invincible=!0,this.lastHitTime=Date.now(),this.health<=0&&this.eventEmitter.emit("gameOver"))}activatePowerup(t){a.POWERUP.TYPES[t].effect(this),this.activePowerups.push({type:t,startTime:Date.now()}),this.eventEmitter.emit("powerUpActivated",t),setTimeout(()=>this.deactivatePowerup(t),a.POWERUP.DURATION)}deactivatePowerup(t){switch(this.activePowerups=this.activePowerups.filter(s=>s.type!==t),t){case"RAPID_FIRE":this.fireRate=a.PLAYER.FIRE_RATE;break;case"TRIPLE_SHOT":this.bulletType="single";break;case"SHIELD":this.shieldActive=!1;break}this.eventEmitter.emit("powerUpDeactivated",t)}getHealth(){return this.health}setFireRate(t){this.fireRate=t}setBulletType(t){this.bulletType=t}activateShield(){this.shieldActive=!0}getPosition(){return{x:this.x,y:this.y}}}class f{constructor(e){h(this,"score",0);this.eventEmitter=e}getScore(){return this.score}addScore(e){this.score+=e,this.eventEmitter.emit("scoreUpdated",this.score)}}class O{constructor(e,t,s,i,r,n){h(this,"ctx");h(this,"bullets",[]);h(this,"enemies",[]);h(this,"stars",[]);h(this,"explosions",[]);h(this,"planets",[]);h(this,"nebulas",[]);h(this,"auroras",[]);h(this,"powerups",[]);h(this,"boss",null);h(this,"bossBullets",[]);h(this,"level",1);h(this,"bossSpawnScore",1e3);h(this,"currentScore",0);h(this,"lastTime",0);h(this,"deltaTime",0);h(this,"difficultyFactor",0);h(this,"currentBossHealth",a.BOSS.INITIAL_HEALTH);h(this,"handleKeyDown",e=>{this.player.setKeyState(e.key,!0)});h(this,"handleKeyUp",e=>{this.player.setKeyState(e.key,!1)});h(this,"handleEnemyDestroyed",e=>{const t=e.getPosition(),s={x:t.x+e.getWidth()/2,y:t.y+e.getHeight()/2};this.explosions.push(new p(s)),this.scoreManager.addScore(e.getScore())});h(this,"handlePlayerShot",e=>{this.bullets.push(e)});h(this,"handlePlayerDamaged",e=>{this.player.takeDamage(e),this.player.getHealth()<=0&&this.gameOver()});h(this,"handleBossDamaged",()=>{this.boss&&this.boss.takeDamage()&&this.eventEmitter.emit("bossDefeated")});h(this,"handleBossDefeated",()=>{this.boss&&(this.explosions.push(new p(this.boss.getPosition())),this.boss=null,this.handleBossDefeat())});h(this,"handlePowerUpCollected",e=>{this.player.activatePowerup(e.getType())});h(this,"gameLoop",e=>{this.deltaTime=(e-this.lastTime)/1e3,this.lastTime=e,this.stateManager.isPlaying()&&(this.update(),this.draw()),requestAnimationFrame(this.gameLoop)});h(this,"spawnEnemy",()=>{if(this.stateManager.isPlaying()&&!this.boss){const e=Object.keys(a.ENEMY.TYPES),t=e[Math.floor(Math.random()*e.length)];this.enemies.push(this.gameObjectFactory.createEnemy(t,this)),Math.random()<a.POWERUP.SPAWN_CHANCE&&this.powerups.push(this.gameObjectFactory.createPowerUp())}});h(this,"restartGame",()=>{const e=document.getElementById("gameOver");e&&e.classList.add("hidden"),this.resetGame(),this.start()});this.canvas=e,this.eventEmitter=t,this.scoreManager=s,this.player=i,this.gameObjectFactory=r,this.stateManager=n,this.ctx=this.canvas.getContext("2d"),this.canvas.width=a.CANVAS.WIDTH,this.canvas.height=a.CANVAS.HEIGHT,this.initializeGameObjects(),this.setupEventListeners(),this.stateManager.setState("PLAYING",this)}initializeGameObjects(){this.stars=Array.from({length:a.BACKGROUND.STAR_COUNT},()=>this.gameObjectFactory.createStar()),this.planets=Array.from({length:a.BACKGROUND.PLANET_COUNT},()=>this.gameObjectFactory.createPlanet()),this.nebulas=Array.from({length:a.BACKGROUND.NEBULA_COUNT},()=>this.gameObjectFactory.createNebula()),this.auroras=Array.from({length:2},()=>this.gameObjectFactory.createAurora())}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp);const e=document.getElementById("restartButton");e&&e.addEventListener("click",this.restartGame),this.eventEmitter.on("enemyDestroyed",this.handleEnemyDestroyed),this.eventEmitter.on("playerShot",this.handlePlayerShot),this.eventEmitter.on("playerDamaged",this.handlePlayerDamaged),this.eventEmitter.on("bossDamaged",this.handleBossDamaged),this.eventEmitter.on("bossDefeated",this.handleBossDefeated),this.eventEmitter.on("powerUpCollected",this.handlePowerUpCollected)}start(){this.eventEmitter.emit("gameStarted"),this.gameLoop(0),setInterval(this.spawnEnemy,a.ENEMY.SPAWN_INTERVAL)}update(){this.stateManager.update(this),this.stateManager.isPlaying()&&(this.player.update(this.deltaTime),this.updateGameObjects(),this.checkCollisions(),this.removeOffscreenObjects(),this.eventEmitter.emit("healthChanged",this.player.getHealth()),this.eventEmitter.emit("levelUpdated",this.level),this.eventEmitter.emit("scoreUpdated",this.scoreManager.getScore()))}updateGameObjects(){this.bullets.forEach(e=>e.update(this.deltaTime)),this.enemies.forEach(e=>e.update(this.deltaTime)),this.powerups.forEach(e=>e.update(this.deltaTime)),this.explosions.forEach(e=>e.update(this.deltaTime)),this.stars.forEach(e=>e.update(this.deltaTime)),this.planets.forEach(e=>e.update(this.deltaTime)),this.auroras.forEach(e=>e.update(this.deltaTime)),this.bossBullets.forEach(e=>e.update(this.deltaTime)),this.boss&&this.boss.update(this.deltaTime),this.currentScore=this.scoreManager.getScore(),this.currentScore>=this.bossSpawnScore&&!this.boss&&this.spawnBoss()}spawnBoss(){this.boss=new H(this),this.eventEmitter.emit("bossSpawned"),this.showMessage("ボスが出現しました！")}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions(),this.checkPlayerPowerupCollisions(),this.boss&&this.checkBossBattleCollisions()}checkBulletEnemyCollisions(){for(let e=this.bullets.length-1;e>=0;e--)for(let t=this.enemies.length-1;t>=0;t--)if(this.checkCollision(this.bullets[e],this.enemies[t])){this.bullets.splice(e,1),this.enemies[t].takeDamage()&&(this.eventEmitter.emit("enemyDestroyed",this.enemies[t]),this.enemies.splice(t,1));break}}checkPlayerEnemyCollisions(){for(let e=this.enemies.length-1;e>=0;e--)this.checkCollision(this.player,this.enemies[e])&&(this.eventEmitter.emit("playerDamaged",20),this.eventEmitter.emit("enemyDestroyed",this.enemies[e]),this.enemies.splice(e,1))}checkPlayerPowerupCollisions(){for(let e=this.powerups.length-1;e>=0;e--)this.checkCollision(this.player,this.powerups[e])&&(this.eventEmitter.emit("powerUpCollected",this.powerups[e]),this.powerups.splice(e,1))}checkBossBattleCollisions(){this.boss&&this.checkCollision(this.player,this.boss)&&this.eventEmitter.emit("playerDamaged",20);for(let e=this.bullets.length-1;e>=0;e--)this.boss&&this.checkCollision(this.bullets[e],this.boss)&&(this.bullets.splice(e,1),this.eventEmitter.emit("bossDamaged"));for(let e=this.bossBullets.length-1;e>=0;e--)this.checkCollision(this.player,this.bossBullets[e])&&(this.eventEmitter.emit("playerDamaged",20),this.bossBullets.splice(e,1))}removeOffscreenObjects(){this.bullets=this.bullets.filter(e=>e.isOnScreen()),this.enemies=this.enemies.filter(e=>e.isOnScreen()),this.powerups=this.powerups.filter(e=>e.isOnScreen()),this.explosions=this.explosions.filter(e=>!e.isFinished()),this.bossBullets=this.bossBullets.filter(e=>e.isOnScreen())}drawBackground(){const e=this.ctx.createLinearGradient(0,0,0,a.CANVAS.HEIGHT);e.addColorStop(0,"rgba(10, 10, 35, 1)"),e.addColorStop(.5,"rgba(20, 20, 50, 1)"),e.addColorStop(1,"rgba(30, 30, 70, 1)"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,a.CANVAS.WIDTH,a.CANVAS.HEIGHT),this.nebulas.forEach(t=>t.draw(this.ctx)),this.planets.forEach(t=>t.draw(this.ctx)),this.stars.forEach(t=>t.draw(this.ctx)),this.auroras.forEach(t=>t.draw(this.ctx))}draw(){this.drawBackground(),this.player.draw(this.ctx),this.bullets.forEach(e=>e.draw(this.ctx)),this.enemies.forEach(e=>e.draw(this.ctx)),this.powerups.forEach(e=>e.draw(this.ctx)),this.explosions.forEach(e=>e.draw(this.ctx)),this.boss&&(this.boss.draw(this.ctx),this.bossBullets.forEach(e=>e.draw(this.ctx)))}checkCollision(e,t){return e.getX()<t.getX()+t.getWidth()&&e.getX()+e.getWidth()>t.getX()&&e.getY()<t.getY()+t.getHeight()&&e.getY()+e.getHeight()>t.getY()}gameOver(){this.stateManager.setState("GAME_OVER",this),this.eventEmitter.emit("gameOver");const e=document.getElementById("gameOver");e&&e.classList.remove("hidden");const t=document.getElementById("finalScore");t&&(t.textContent=this.scoreManager.getScore().toString())}resetGame(){this.player=new E(this.eventEmitter),this.bullets=[],this.enemies=[],this.powerups=[],this.explosions=[],this.boss=null,this.bossBullets=[],this.level=1,this.bossSpawnScore=1e3,this.scoreManager=new f(this.eventEmitter),this.stateManager.setState("PLAYING",this)}handleBossDefeat(){this.scoreManager.addScore(500),this.showMessage(`レベル ${this.level} クリア！次のレベルが始まります。`),this.level++,this.eventEmitter.emit("levelUpdated",this.level),setTimeout(()=>{this.startNextLevel()},3e3),this.bossSpawnScore=this.currentScore+1e3}startNextLevel(){this.enemies=[],this.bossBullets=[],this.powerups=[],this.difficultyFactor=this.level*.1,this.currentBossHealth=a.BOSS.INITIAL_HEALTH+(this.level-1)*10,this.bossSpawnScore=this.scoreManager.getScore()+1e3,this.eventEmitter.emit("levelStarted",this.level),this.showMessage(`レベル ${this.level} 開始！`)}showMessage(e){const t=document.createElement("div");t.textContent=e,t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="white",t.style.fontSize="24px",t.style.textAlign="center",document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},3e3)}addBossBullet(e){this.bossBullets.push(e)}pauseGame(){this.stateManager.setState("PAUSED",this),this.eventEmitter.emit("gamePaused")}resumeGame(){this.stateManager.setState("PLAYING",this),this.eventEmitter.emit("gameResumed")}getDifficultyFactor(){return this.difficultyFactor}getCurrentBossHealth(){return this.currentBossHealth}}class L{enter(e){console.log("Entering Starting state")}update(e){}exit(e){console.log("Exiting Starting state")}}class N{enter(e){console.log("Entering Playing state")}update(e){}exit(e){console.log("Exiting Playing state")}}class R{enter(e){console.log("Entering Paused state")}update(e){}exit(e){console.log("Exiting Paused state")}}class B{enter(e){console.log("Entering Game Over state")}update(e){}exit(e){console.log("Exiting Game Over state")}}class U{constructor(){h(this,"currentState");h(this,"states");this.states={STARTING:new L,PLAYING:new N,PAUSED:new R,GAME_OVER:new B},this.currentState=this.states.STARTING}setState(e,t){this.currentState.exit(t),this.currentState=this.states[e],this.currentState.enter(t)}update(e){this.currentState.update(e)}isPlaying(){return this.currentState===this.states.PLAYING}getCurrentState(){return Object.keys(this.states).find(e=>this.states[e]===this.currentState)}}class G{constructor(e,t,s,i,r,n){this.eventEmitter=e,this.scoreElement=t,this.levelElement=s,this.healthElement=i,this.healthBarElement=r,this.gameOverElement=n,this.setupEventListeners()}setupEventListeners(){this.eventEmitter.on("scoreUpdated",e=>this.updateScoreDisplay(e)),this.eventEmitter.on("healthChanged",e=>this.updateHealthDisplay(e)),this.eventEmitter.on("levelUpdated",e=>this.updateLevelDisplay(e)),this.eventEmitter.on("gameOver",()=>this.showGameOver())}updateScoreDisplay(e){this.scoreElement.textContent=e.toString()}updateLevelDisplay(e){this.levelElement.textContent=e.toString()}updateHealthDisplay(e){this.healthElement.textContent=e.toString();const t=e/a.PLAYER.MAX_HEALTH*100;this.healthBarElement.style.width=`${t}%`}showGameOver(){this.gameOverElement.classList.remove("hidden")}}class k{constructor(){h(this,"listeners",{})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(s=>{try{s(...t)}catch(i){console.error(`Error in listener for event ${String(e)}:`,i)}})}}function c(o){const e=document.getElementById(o);if(!e)throw new Error(`Element with id "${o}" not found`);return e}function W(){const o=c("gameCanvas"),e=new k,t=new E(e),s=new C,i=new f(e),r=new U,n=c("levelValue"),l=c("healthValue"),d=c("healthBarFill"),y=c("gameOver"),S=c("scoreValue");new G(e,S,n,l,d,y),new O(o,e,i,t,s,r).start()}document.addEventListener("DOMContentLoaded",W);
